(this["webpackJsonpfuse-react-app"]=this["webpackJsonpfuse-react-app"]||[]).push([[127],{1392:function(e,t,a){"use strict";a.d(t,"a",(function(){return A}));var n=a(101),r=a(4),c=a(54),o=a(14),i=a(6),s=a(1),l=a(1297),d=a(51),u=a(1379),j=a(41),b=a(15),m=a(0);var O=function(e){var t=Object(d.a)(),a=Object(b.useSelector)(Object(j.c)(t.palette.primary.main));return Object(m.jsx)("div",{className:"FusePageCarded-header",children:e.header&&Object(m.jsx)(u.a,{theme:a,children:e.header})})},h=a(8),p=a(17),f=a(133),x=a(1376),v=a(1380);var g=function(e){var t=Object(d.a)(),a=Object(b.useSelector)(Object(j.c)(t.palette.primary.main));return Object(m.jsxs)(m.Fragment,{children:[e.header&&Object(m.jsx)(u.a,{theme:a,children:Object(m.jsx)("div",{className:Object(i.default)("FusePageCarded-sidebarHeader",e.variant),children:e.header})}),e.content&&Object(m.jsx)(c.default,{className:"FusePageCarded-sidebarContent",enable:e.innerScroll,children:e.content})]})};function C(e,t){var a=Object(s.useState)(!1),n=Object(p.a)(a,2),r=n[0],c=n[1];Object(s.useImperativeHandle)(t,(function(){return{toggleSidebar:o}}));var o=function(){c(!r)};return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(x.a,{lgUp:"permanent"===e.variant,children:Object(m.jsx)(v.a,{variant:"temporary",anchor:e.position,open:r,onOpen:function(e){},onClose:function(e){return o()},disableSwipeToOpen:!0,classes:{root:Object(i.default)("FusePageCarded-sidebarWrapper",e.variant),paper:Object(i.default)("FusePageCarded-sidebar",e.variant,"left"===e.position?"FusePageCarded-leftSidebar":"FusePageCarded-rightSidebar")},ModalProps:{keepMounted:!0},container:e.rootRef.current,BackdropProps:{classes:{root:"FusePageCarded-backdrop"}},style:{position:"absolute"},children:Object(m.jsx)(g,Object(h.a)({},e))})}),"permanent"===e.variant&&Object(m.jsx)(x.a,{lgDown:!0,children:Object(m.jsx)(f.a,{variant:"permanent",className:Object(i.default)("FusePageCarded-sidebarWrapper",e.variant),open:r,classes:{paper:Object(i.default)("FusePageCarded-sidebar",e.variant,"left"===e.position?"FusePageCarded-leftSidebar":"FusePageCarded-rightSidebar")},children:Object(m.jsx)(g,Object(h.a)({},e))})})]})}var S,E=Object(s.forwardRef)(C),N=Object(o.a)("div")((function(e){var t=e.theme;return{display:"flex",flexDirection:"row",minWidth:0,minHeight:"100%",position:"relative",flex:"1 1 auto",width:"100%",height:"auto",backgroundColor:t.palette.background.default,"& .FusePageCarded-innerScroll":{height:"100%"},"& .FusePageCarded-topBg":{position:"absolute",left:0,right:0,top:0,height:T,background:"linear-gradient(to right, ".concat(t.palette.primary.dark," 0%, ").concat(t.palette.primary.main," 100%)"),backgroundSize:"cover",pointerEvents:"none"},"& .FusePageCarded-contentWrapper":Object(r.a)({display:"flex",flexDirection:"column",padding:"0 3.2rem",flex:"1 1 100%",zIndex:2,maxWidth:"100%",minWidth:0,minHeight:0},t.breakpoints.down("sm"),{padding:"0 1.6rem"}),"& .FusePageCarded-header":{height:P,minHeight:P,maxHeight:P,display:"flex",color:t.palette.primary.contrastText},"& .FusePageCarded-headerSidebarToggleButton":{color:t.palette.primary.contrastText},"& .FusePageCarded-contentCard":{display:"flex",flex:"1 1 100%",flexDirection:"column",backgroundColor:t.palette.background.paper,boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",minHeight:0,borderRadius:"20px 20px 0 0"},"& .FusePageCarded-toolbar":{height:I,minHeight:I,display:"flex",alignItems:"center",borderBottom:"1px solid ".concat(t.palette.divider)},"& .FusePageCarded-content":{flex:"1 1 auto",height:"100%",overflow:"auto",WebkitOverflowScrolling:"touch"},"& .FusePageCarded-sidebarWrapper":{position:"absolute",backgroundColor:"transparent",zIndex:5,overflow:"hidden","&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{zIndex:1,position:"relative"})},"& .FusePageCarded-sidebar":{position:"absolute","&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{backgroundColor:"transparent",position:"relative",border:"none",overflow:"hidden"}),width:w,height:"100%"},"& .FusePageCarded-leftSidebar":{},"& .FusePageCarded-rightSidebar":{},"& .FusePageCarded-sidebarHeader":{height:T,minHeight:T,color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.dark,"&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{backgroundColor:"transparent"})},"& .FusePageCarded-sidebarContent":Object(r.a)({display:"flex",flex:"1 1 auto",flexDirection:"column",backgroundColor:t.palette.background.default,color:t.palette.text.primary},t.breakpoints.up("lg"),{overflow:"auto",WebkitOverflowScrolling:"touch"}),"& .FusePageCarded-backdrop":{position:"absolute"}}})),w=240,T=200,I=64,P=T-I,_=Object(s.forwardRef)((function(e,t){var a=Object(s.useRef)(null),n=Object(s.useRef)(null),r=Object(s.useRef)(null),o=e.rightSidebarHeader||e.rightSidebarContent,d=e.leftSidebarHeader||e.leftSidebarContent;return Object(s.useImperativeHandle)(t,(function(){return{rootRef:r,toggleLeftSidebar:function(){a.current.toggleSidebar()},toggleRightSidebar:function(){n.current.toggleSidebar()}}})),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(l.a,{styles:function(t){return{"#fuse-main":{height:e.innerScroll&&"100vh"}}}}),Object(m.jsxs)(N,{className:Object(i.default)("FusePageCarded-root",e.innerScroll&&"FusePageCarded-innerScroll",e.className),ref:r,children:[Object(m.jsx)("div",{className:"FusePageCarded-topBg"}),Object(m.jsxs)("div",{className:"flex container w-full",children:[d&&Object(m.jsx)(E,{position:"left",header:e.leftSidebarHeader,content:e.leftSidebarContent,variant:e.leftSidebarVariant||"permanent",innerScroll:e.innerScroll,ref:a,rootRef:r}),Object(m.jsxs)("div",{className:Object(i.default)("FusePageCarded-contentWrapper",d&&(void 0===e.leftSidebarVariant||"permanent"===e.leftSidebarVariant)&&"lg:ltr:pl-0 lg:rtl:pr-0",o&&(void 0===e.rightSidebarVariant||"permanent"===e.rightSidebarVariant)&&"lg:pr-0"),children:[Object(m.jsx)(O,{header:e.header}),Object(m.jsxs)("div",{className:Object(i.default)("FusePageCarded-contentCard",e.innerScroll&&"inner-scroll"),children:[e.contentToolbar&&Object(m.jsx)("div",{className:"FusePageCarded-toolbar",children:e.contentToolbar}),e.content&&Object(m.jsx)(c.default,{className:"FusePageCarded-content",enable:e.innerScroll,scrollToTopOnRouteChange:e.innerScroll,children:e.content})]})]}),o&&Object(m.jsx)(E,{position:"right",header:e.rightSidebarHeader,content:e.rightSidebarContent,variant:e.rightSidebarVariant||"permanent",innerScroll:e.innerScroll,ref:n,rootRef:r})]})]})]})}));_.defaultProps={};var A=Object(s.memo)(Object(o.a)(_)(S||(S=Object(n.a)([""]))))},1651:function(e,t,a){"use strict";a.d(t,"b",(function(){return _})),a.d(t,"a",(function(){return A}));var n=a(77),r=a(8),c=a(17),o=a(1337),i=a(770),s=a(779),l=a(1333),d=a(1349),u=a(1),j=a(47),b=a(1377),m=a(15),O=a(1338),h=a(1470),p=a(1469),f=a(1500),x=a(318),v=a(76),g=a(189),C=a(1335),S=a(1336),E=a(55),N=a(331),w=a.n(N),T=a(322),I=a(0),P=v.e().shape({name:v.g().required(),phone:v.g().length(9),address:v.g(),isFamiliar:v.b()}),_=function(e){var t=e.customer,a=Object(m.useDispatch)(),n=Object(j.useForm)({mode:"onChange",defaultValues:{},resolver:Object(g.a)(P)}),v=Object(u.useState)([]),N=Object(c.a)(v,2),_=N[0],A=N[1],L=Object(b.a)("invoices").t,y=n.control,D=n.formState,R=(n.setValue,n.reset),F=n.watch,U=n.getValues,k=D.errors;Object(u.useEffect)((function(){Object(E.b)().then((function(e){A(e)}))}),[A,R]),Object(u.useEffect)((function(){if(_.length>0)if(t){var e,a=Object(r.a)({},t);a.phoneCountryId=null!==(e=a.phoneCountryId)&&void 0!==e?e:_[0].id,R(a)}else R({id:0,name:"",phone:"",address:"",isFamiliar:!1,phoneCountryId:_[0].id})}),[t,_,R]);var M=F();return w.a.isEmpty(M)?Object(I.jsx)(I.Fragment,{children:Object(I.jsx)(p.a,{children:Object(I.jsx)(T.a,{})})}):Object(I.jsxs)(j.FormProvider,Object(r.a)(Object(r.a)({},n),{},{children:[Object(I.jsx)(f.a,{id:"alert-dialog-title",children:L("CREATE_CUSTOMER_TITLE",{name:M.name})}),Object(I.jsxs)(p.a,{children:[Object(I.jsx)(j.Controller,{name:"name",control:y,render:function(e){var t=e.field;return Object(I.jsx)(o.a,Object(r.a)(Object(r.a)({},t),{},{className:"mt-8 mb-16",error:!!k.name,required:!0,label:L("CUSTOMER_NAME_LABEL"),autoFocus:!0,id:"name",variant:"outlined",fullWidth:!0}))}}),Object(I.jsxs)("div",{className:"flex w-full mt-8 mb-16",children:[Object(I.jsx)(j.Controller,{name:"phoneCountryId",control:y,render:function(e){var t=e.field;return Object(I.jsx)(i.a,{className:"w-1/5",children:Object(I.jsx)(s.a,{id:"phone-country-select",value:t.value,onChange:function(e){t.onChange(e.target.value)},children:_.map((function(e,t){return Object(I.jsx)(l.a,{value:e.id,children:Object(I.jsx)("img",{className:"max-w-none w-auto h-20",src:e.logoUrl,alt:"product"})},e.id)}))})})}}),Object(I.jsx)(j.Controller,{name:"phone",control:y,render:function(e){var t=e.field;return Object(I.jsx)(o.a,Object(r.a)(Object(r.a)({},t),{},{className:"ml-8 flex-1",error:!!k.phone,required:!0,label:L("CUSTOMER_PHONE_LABEL"),id:"phone",variant:"outlined",fullWidth:!0,InputProps:{startAdornment:Object(I.jsx)(d.a,{position:"start",children:w.a.find(_,(function(e){return e.id===M.phoneCountryId})).phonePrefix})}}))}})]}),Object(I.jsx)(j.Controller,{name:"address",control:y,render:function(e){var t=e.field;return Object(I.jsx)(o.a,Object(r.a)(Object(r.a)({},t),{},{className:"mt-8 mb-16",error:!!k.address,required:!0,label:L("CUSTOMER_ADDRESS_LABEL"),id:"address",variant:"outlined",fullWidth:!0}))}}),Object(I.jsx)(j.Controller,{name:"isFamiliar",control:y,render:function(e){var t=e.field,a=t.onChange,n=t.value;return Object(I.jsx)(C.a,{className:"mt-8 mb-16",label:L("CUSTOMER_IS_FAMILIAR_LABEL"),control:Object(I.jsx)(S.a,{onChange:function(e){a(e.target.checked)},checked:n,name:"hasAutoCalculatePermission"})})}})]}),Object(I.jsxs)(h.a,{children:[Object(I.jsx)(O.a,{onClick:function(){return a(Object(x.a)())},color:"error",children:L("CANCEL_BUTTON")}),Object(I.jsx)(O.a,{onClick:function(){var t=U();console.log("create customer data",t),0===t.id?e.createCustomer(t):e.updateCustomer(t)},color:"secondary",children:L("SAVE_BUTTON")})]})]}))},A=function(e){var t=e.title,a=e.content,n=e.onAccept,r=Object(m.useDispatch)(),c=Object(b.a)("common").t;return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(f.a,{children:t}),Object(I.jsx)(p.a,{children:a}),Object(I.jsxs)(h.a,{children:[Object(I.jsx)(O.a,{onClick:function(){return r(Object(x.a)())},color:"error",children:c("CANCEL_BUTTON")}),Object(I.jsx)(O.a,{onClick:function(){n()},color:"primary",children:c("OK_BUTTON")})]})]})},L={},y={OK_BUTTON:"\u0110\u1ed3ng \xfd",CANCEL_BUTTON:"Hu\u1ef7"};n.a.addResourceBundle("en","common",L),n.a.addResourceBundle("vi","common",y)},1667:function(e,t,a){"use strict";t.a={THUMBNAIL_ASSET_TYPE:"thumbnail",SLIDE_ASSET_TYPE:"slide",NEW_MODE:"new",UPDATE_MODE:"update",REVIEW_MODE:"review"}},1697:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return d})),a.d(t,"e",(function(){return u})),a.d(t,"f",(function(){return j}));var n=a(55),r=a(37),c=r.createSlice,o=(0,r.createAsyncThunk)("invoices/invoices/getInvoices",(function(e,t){var a=t.dispatch,r=t.getState;return new Promise((function(e,t){var c=r().invoices.invoices.page,o=r().invoices.invoices.rowsPerPage,i=r().invoices.invoices,s=i.searchText,l=i.order;n.a.get(n.c.getInvoices,{params:{pageIndex:c,pageSize:o,search:s,sortFieldName:l.id,isSortAscending:"asc"===l.direction}}).then((function(t){a(m(t.data.data)),a(b(t.data.totalItems)),e()}))}))})),i=c({initialState:{searchText:"",data:[],order:{id:"code",direction:"asc"},totalRecords:0,rowsPerPage:5,page:0},name:"invoices",reducers:{resetState:function(e,t){},setTotalRecords:function(e,t){e.totalRecords=t.payload},setData:function(e,t){e.data=t.payload},setInvoiceSearchText:function(e,t){e.searchText=t.payload},setOrder:function(e,t){e.order=t.payload},setPage:function(e,t){e.page=t.payload},setRowsPerPage:function(e,t){e.rowsPerPage=t.payload}}}),s=i.actions,l=(s.resetState,s.setInvoiceSearchText),d=s.setOrder,u=s.setPage,j=s.setRowsPerPage,b=s.setTotalRecords,m=s.setData;t.a=i.reducer},1698:function(e,t,a){"use strict";a.d(t,"c",(function(){return d})),a.d(t,"e",(function(){return u})),a.d(t,"a",(function(){return j})),a.d(t,"d",(function(){return b})),a.d(t,"f",(function(){return m})),a.d(t,"h",(function(){return f})),a.d(t,"g",(function(){return x}));var n=a(8),r=a(55),c=a(516),o=a(1667),i=a(37),s=i.createSlice,l=i.createAsyncThunk,d=l("invoices/createUpdateInvoice/getCustomers",(function(e,t){var a=t.dispatch;return new Promise((function(e,t){r.a.get(r.c.getCustomers).then((function(t){var n=t.data.data;a(p(n)),e()}))}))})),u=l("invoices/createUpdateInvoice/getProducts",(function(e,t){var a=t.dispatch;return new Promise((function(e,t){Object(c.i)().then((function(t){a(v(t)),e();var r=t.map((function(e){return new Promise((function(t){Object(c.f)(e.id).then((function(a){var r=Object(n.a)({},e);r.thumbnail=a,t(r)}))}))}));Promise.all(r).then((function(e){a(v(e))}))}))}))})),j=l("invoices/createUpdateInvoice/createInvoice",(function(e,t){t.dispatch,t.getState;return new Promise((function(t,a){r.a.post(r.c.createInvoice,e).then((function(e){t(e.data.data)})).catch((function(e){a()}))}))})),b=l("invoices/createUpdateInvoice/getInvoiceById",(function(e,t){var a=t.dispatch;t.getState;return new Promise((function(t,n){r.a.get(r.c.getInvoiceById(e)).then((function(e){var n=e.data.data,r={id:n.id,customer:{id:n.customerId,name:n.customerName,phone:n.customerPhone,address:n.customerAddress,phonePrefix:n.customerPhonePrefix},code:"",date:n.createdDate,customerDebt:n.debt,totalCost:n.totalCost,deposit:n.deposit,rest:n.rest,details:n.details.map((function(e){return{productId:e.productId,description:e.description,quantity:e.quantity,originalPrice:e.originalPrice,price:e.price,productName:"".concat(e.productName," | ").concat(e.unitName),totalCost:e.totalCost}}))};a(g(r)),t()}))}))})),m=l("invoices/createUpdateInvoice/restoreInvoiceById",(function(e,t){var a=t.dispatch;t.getState;return new Promise((function(t,n){r.a.post(r.c.restoreInvoiceById(e)).then((function(e){a(x(o.a.NEW_MODE)),t()}))}))})),O=s({initialState:{customers:[],invoice:{},mode:o.a.NEW_MODE,products:[]},name:"createUpdateInvoice",reducers:{resetState:function(e,t){},setCustomers:function(e,t){e.customers=t.payload},setProducts:function(e,t){e.products=t.payload},setInvoice:function(e,t){e.invoice=t.payload},setNewInvoice:function(e,t){e.invoice={customer:null,code:"",date:new Date,customerDebt:0,totalCost:0,deposit:0,rest:0,details:[]}},setMode:function(e,t){e.mode=t.payload}}}),h=O.actions,p=(h.resetState,h.setCustomers),f=h.setNewInvoice,x=h.setMode,v=h.setProducts,g=h.setInvoice;t.b=O.reducer},1763:function(e,t,a){"use strict";var n=a(224),r=a(1),c=a(15).useDispatch;t.a=function(){var e=c();return{showNotification:Object(r.useCallback)((function(t){console.log("show notification",t),e(Object(n.b)(t))}),[e])}}},1766:function(e,t,a){"use strict";var n=a(160),r=a(1697),c=a(1698);t.a=Object(n.d)({invoices:r.a,createUpdateInvoice:c.b})},3408:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a(20),c=a(17),o=a(4),i=a(14),s=a(1392),l=a(47),d=a(189),u=a(1),j=a(66),b=a(331),m=a.n(b),O=a(191),h=a(128),p=a(76),f=a(322),x=a(1377),v=a(15),g=a(1664),C=a(1337),S=a(1515),E=a(1349),N=a(1338),w=a(1391),T=a(1330),I=a(318),P=a(516),_=a(1766),A=a(1667),L=a(1698),y=a(51),D=a(200),R=a(1374),F=a(43),U=a(1887),k=a(1763),M=a(169),B=a(1651),W=a(1348),V=a(1350),H=a(1522),q=a(1526),z=a(1525),Y=a(1523),K=a(1524),J=a(1470),Q=a(1469),G=a(1500),X=a(0),Z=Object(i.a)("div")((function(e){var t=e.theme;return{"& table ":{"& th:first-child, & td:first-child":{paddingLeft:"".concat(0,"!important")},"& th:last-child, & td:last-child":{paddingRight:"".concat(0,"!important")}},"& .divider":{width:1,backgroundColor:t.palette.divider,height:144},"& .seller":{backgroundColor:t.palette.primary.dark,color:t.palette.getContrastText(t.palette.primary.dark),marginRight:-88,paddingRight:66,width:480,"& .divider":{backgroundColor:t.palette.getContrastText(t.palette.primary.dark),opacity:.5}}}})),$=function(e){var t=e.formContext,a=Object(x.a)("invoices").t,n=Object(v.useSelector)((function(e){return e.auth.user.shop})),r=(t.control,(0,t.watch)()),c=Object(v.useDispatch)();return console.log("invoice",r),Object(X.jsxs)(X.Fragment,{children:[Object(X.jsx)(G.a,{id:"alert-dialog-title",children:a("PREVIEW_INVOICE_TITLE",{customerName:r.customer.name})}),Object(X.jsx)(Q.a,{children:Object(X.jsx)(Z,{className:"flex-grow flex-shrink-0 p-0",children:Object(X.jsx)(W.a,{className:"w-xl mx-auto shadow-0",children:Object(X.jsxs)(V.a,{className:"p-20 print:p-0",children:[Object(X.jsxs)("div",{className:"flex justify-between",children:[Object(X.jsxs)("div",{children:[Object(X.jsx)("table",{className:"mb-8",children:Object(X.jsx)("tbody",{children:Object(X.jsxs)("tr",{children:[Object(X.jsx)("td",{className:"pb-4",children:Object(X.jsx)(D.a,{className:"font-light",variant:"h6",color:"textSecondary",children:a("INVOICE_PDF_HEADER")})}),Object(X.jsx)("td",{className:"pb-4 px-8",children:Object(X.jsx)(D.a,{className:"font-light",variant:"h6",color:"inherit",children:r.code})})]})})}),Object(X.jsx)(D.a,{color:"textSecondary",children:r.customer&&r.customer.name}),Object(X.jsx)(D.a,{color:"textSecondary",children:r.customer&&r.customer.phone}),Object(X.jsx)(D.a,{color:"textSecondary",children:r.customer&&r.customer.address}),Object(X.jsxs)(D.a,{color:"textSecondary",children:[a("TOTAL_COST_LABEL"),": ",r.totalCost.toLocaleString()," ",n.cashUnitName]}),Object(X.jsx)(D.a,{color:"textSecondary",children:r.customerDebt>0&&"".concat(a("DEBT_LABEL"),": ").concat(r.customerDebt.toLocaleString()," ").concat(n.cashUnitName)}),Object(X.jsxs)(D.a,{color:"textSecondary",children:[a("DEPOSIT_LABEL"),": ",r.deposit.toLocaleString()," ",n.cashUnitName]}),Object(X.jsxs)(D.a,{color:"textSecondary",children:[a("REST_LABEL"),": ",r.rest.toLocaleString()," ",n.cashUnitName]})]}),Object(X.jsxs)("div",{className:"seller flex items-center p-16",children:[Object(X.jsx)("img",{className:"w-80",src:n.logoUrl,alt:"logo"}),Object(X.jsx)("div",{className:"divider mx-8 h-96"}),Object(X.jsxs)("div",{className:"px-8",children:[Object(X.jsxs)(D.a,{color:"inherit",children:[n.name,"."]}),Object(X.jsx)(D.a,{color:"inherit",children:n.address}),n.phones&&n.phones.map((function(e,t){return Object(X.jsx)(D.a,{color:"inherit",children:"".concat(e.ownerName," (").concat(e.phonePrefix).concat(e.phone,")")},t)})),n.emails&&n.emails.map((function(e){return Object(X.jsx)(D.a,{color:"inherit",children:e})}))]})]})]}),Object(X.jsx)("div",{className:"mt-6",children:Object(X.jsxs)(H.a,{className:"simple",children:[Object(X.jsx)(Y.a,{children:Object(X.jsxs)(K.a,{children:[Object(X.jsx)(z.a,{children:a("PRODUCT_LABEL")}),Object(X.jsx)(z.a,{align:"right",children:a("PRICE_LABEL")}),Object(X.jsx)(z.a,{align:"right",children:a("QUANTITY_LABEL")}),Object(X.jsx)(z.a,{align:"right",children:a("TOTAL_COST_LABEL")})]})}),Object(X.jsx)(q.a,{children:r.details.map((function(e,t){return Object(X.jsxs)(K.a,{children:[Object(X.jsxs)(z.a,{children:[Object(X.jsx)(D.a,{variant:"subtitle1",children:e.productName}),Object(X.jsx)(D.a,{children:e.description})]}),Object(X.jsx)(z.a,{align:"right",children:"".concat(e.price.toLocaleString()," ").concat(n.cashUnitName)}),Object(X.jsx)(z.a,{align:"right",children:e.quantity}),Object(X.jsx)(z.a,{align:"right",children:"".concat(e.totalCost.toLocaleString()," ").concat(n.cashUnitName)})]},t)}))})]})})]})})})}),Object(X.jsx)(J.a,{children:Object(X.jsx)(N.a,{onClick:function(){return c(Object(I.a)())},color:"error",children:a("CANCEL_BUTTON")})})]})},ee=a(770),te=a(1335),ae=a(1459),ne=a(773),re=p.e().shape({isAllowedToShowCustomerInformation:p.b().required(),isAllowedToShowCustomerDeposit:p.b().required(),isAllowedToShowShopInformation:p.b().required()}),ce=function(e){var t=Object(x.a)("invoices").t,a=e.invoice,r=Object(v.useDispatch)(),c=(Object(v.useSelector)((function(e){return e.auth.user.shop})),Object(l.useForm)({mode:"onChange",defaultValues:{isAllowedToShowCustomerInformation:!0,isAllowedToShowCustomerDeposit:!0,isAllowedToShowShopInformation:!0},resolver:Object(d.a)(re)})),o=c.control,i=c.getValues,s=c.formState.errors,u=Object(v.useSelector)((function(e){return e.i18n.language}));return Object(X.jsxs)(l.FormProvider,Object(n.a)(Object(n.a)({},c),{},{children:[Object(X.jsx)(G.a,{id:"alert-dialog-title",children:t("DOWNLOAD_OPTIONS_TITLE",{customerName:a.customer.name})}),Object(X.jsxs)(Q.a,{className:"flex flex-col items-start",children:[Object(X.jsx)(l.Controller,{name:"isAllowedToShowCustomerInformation",control:o,render:function(e){var a,n=e.field;return Object(X.jsxs)(ee.a,{className:"items-center",error:!!s.isAllowedToShowCustomerInformation,children:[Object(X.jsx)(te.a,{label:t("SHOW_CUSTOMER_INFORMATION_DESC"),control:Object(X.jsx)(ae.a,{value:n.value,onChange:n.onChange,defaultChecked:!0})}),Object(X.jsx)(ne.a,{children:null===s||void 0===s||null===(a=s.isAllowedToShowCustomerInformation)||void 0===a?void 0:a.message})]})}}),Object(X.jsx)(l.Controller,{name:"isAllowedToShowCustomerDeposit",control:o,render:function(e){var a,n=e.field;return Object(X.jsxs)(ee.a,{className:"items-center",error:!!s.isAllowedToShowCustomerDeposit,children:[Object(X.jsx)(te.a,{label:t("SHOW_CUSTOMER_DEPOSIT_DESC"),control:Object(X.jsx)(ae.a,{value:n.value,onChange:n.onChange,defaultChecked:!0})}),Object(X.jsx)(ne.a,{children:null===s||void 0===s||null===(a=s.isAllowedToShowCustomerDeposit)||void 0===a?void 0:a.message})]})}}),Object(X.jsx)(l.Controller,{name:"isAllowedToShowShopInformation",control:o,render:function(e){var a,n=e.field;return Object(X.jsxs)(ee.a,{className:"items-center",error:!!s.isAllowedToShowShopInformation,children:[Object(X.jsx)(te.a,{label:t("SHOW_SHOP_INFORMATION_DESC"),control:Object(X.jsx)(ae.a,{value:n.value,onChange:n.onChange,defaultChecked:!0})}),Object(X.jsx)(ne.a,{children:null===s||void 0===s||null===(a=s.isAllowedToShowShopInformation)||void 0===a?void 0:a.message})]})}})]}),Object(X.jsxs)(J.a,{children:[Object(X.jsx)(N.a,{onClick:function(){return r(Object(I.a)())},color:"error",children:t("CANCEL_BUTTON")}),Object(X.jsx)(N.a,{onClick:function(){var e=i();console.log("ok ok ",e),Object(P.e)(a.id,u,e).then((function(e){M.a.downloadUrl(e),r(Object(I.a)())}))},color:"secondary",children:t("OK_BUTTON")})]})]}))},oe=function(){var e=Object(u.useState)(!1),t=Object(c.a)(e,2),a=t[0],n=t[1],r=Object(u.useState)(!1),o=Object(c.a)(r,2),i=o[0],s=o[1],d=Object(v.useDispatch)(),b=Object(l.useFormContext)(),m=b.formState,O=b.watch,h=b.getValues,p=(b.handleSubmit,m.isValid),f=(m.dirtyFields,m.errors,Object(x.a)("invoices").t),g=O("customer"),C=Object(y.a)(),S=Object(j.h)(),E=Object(v.useSelector)((function(e){return e.auth.user.shop})),w=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),_=Object(k.a)().showNotification,W=Object(v.useSelector)((function(e){return e.i18n.language})),V=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=h();n(!0);var a={customerId:t.customer.id,deposit:t.deposit,details:t.details.map((function(e){return{productId:e.productId,quantity:e.quantity,price:e.price,description:e.description,originalPrice:e.originalPrice}}))};console.log("validated data",a),d(Object(L.a)(a)).then((function(t){if(e){var a=t.payload.id;Object(P.e)(a,W).then((function(e){M.a.downloadUrl(e),_({translation:"CREATE_SUCCESSFULLY",options:{variant:"success"}}),n(!1),S.push("/apps/invoices")}))}else _({translation:"CREATE_SUCCESSFULLY",options:{variant:"success"}}),n(!1),S.push("/apps/invoices")})).catch((function(e){n(!1)}))};return Object(X.jsxs)("div",{className:"flex flex-1 w-full items-center justify-between",children:[Object(X.jsxs)("div",{className:"flex flex-col items-start max-w-full min-w-0",children:[Object(X.jsx)(R.a.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1,transition:{delay:.3}},children:Object(X.jsxs)(D.a,{className:"flex items-center sm:mb-12",component:F.a,role:"button",to:"/apps/invoices",color:"inherit",children:[Object(X.jsx)(T.a,{className:"text-20",children:"ltr"===C.direction?"arrow_back":"arrow_forward"}),Object(X.jsx)("span",{className:"hidden sm:flex mx-4 font-medium",children:f("MANAGE_INVOICES_LABEL")})]})}),Object(X.jsx)("div",{className:"flex items-center max-w-full",children:Object(X.jsx)("div",{className:"flex flex-col min-w-0 mx-8 sm:mc-16",children:Object(X.jsxs)(R.a.div,{initial:{x:-20},animate:{x:0,transition:{delay:.3}},children:[Object(X.jsx)(D.a,{className:"text-16 sm:text-20 truncate font-semibold",children:f("NEW_INVOICE_LABEL",{customerName:g?g.name:""})}),Object(X.jsx)(D.a,{variant:"caption",className:"font-medium",children:f("INVOICE_DETAIL")})]})})})]}),Object(X.jsxs)(R.a.div,{className:"flex",initial:{opacity:0,x:20},animate:{opacity:1,x:0,transition:{delay:.3}},children:[w===A.a.REVIEW_MODE&&Object(X.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:i,color:"warning",onClick:function(){d(Object(I.c)({maxWidth:"xs",fullWidth:!0,children:Object(X.jsx)(B.a,{title:f("RESTORE_INVOICE_TITLE"),content:f("RESTORE_INVOICE_CONTENT"),onAccept:function(){var e=h();s(!0),d(Object(L.f)(e.id)).then((function(){s(!1)})),d(Object(I.a)())}})}))},startIcon:Object(X.jsx)(T.a,{className:"hidden sm:flex",children:"restore"}),children:f("RESTORE_BUTTON")}),w===A.a.REVIEW_MODE&&Object(X.jsx)(N.a,{className:"whitespace-nowrap mx-4",variant:"contained",color:"secondary",onClick:function(){var e=h();console.log("shop",E),E.isAllowedToShowInvoiceDownloadOptions?d(Object(I.c)({maxWidth:"xs",fullWidth:!0,children:Object(X.jsx)(ce,{invoice:e})})):Object(P.e)(e.id,W,{isAllowedToShowCustomerInformation:!0,isAllowedToShowCustomerDeposit:!0,isAllowedToShowShopInformation:!0}).then((function(e){M.a.downloadUrl(e)}))},startIcon:Object(X.jsx)(T.a,{className:"hidden sm:flex",children:"download"}),children:f("DOWNLOAD_BUTTON")}),(w===A.a.UPDATE_MODE||w===A.a.NEW_MODE)&&Object(X.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:a,color:"secondary",disabled:!p,onClick:function(){V(!1)},children:f("SAVE_BUTTON")}),(w===A.a.UPDATE_MODE||w===A.a.NEW_MODE)&&Object(X.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:a,color:"secondary",disabled:!p,onClick:function(){V(!0)},children:f("SAVE_DOWNLOAD_BUTTON")}),(w===A.a.UPDATE_MODE||w===A.a.NEW_MODE)&&Object(X.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:a,color:"secondary",disabled:!p,onClick:function(){d(Object(I.c)({maxWidth:"lg",fullWidth:!0,children:Object(X.jsx)($,{formContext:b})}))},children:f("PREVIEW_BUTTON")})]})]})},ie=function(e){var t=e.index,a=Object(l.useFormContext)(),r=a.control,c=(a.watch,a.getValues),o=a.setValue,i=Object(x.a)("invoices").t,s=Object(v.useSelector)((function(e){return e.auth.user.shop})),d=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),u=Object(h.a)((function(e){M.a.convertUnitValue(s.cashUnitId,e).then((function(e){o("details.".concat(t,".totalCost"),e);var a=c("details"),n=0;a.forEach((function(e){n+=e.totalCost})),o("totalCost",n);var r=c("deposit"),i=c("customerDebt");o("rest",n+i-r)}))}),500),j=c("details.".concat(t,".inventoryNumber"));return Object(X.jsx)("div",{className:"flex w-full",children:Object(X.jsxs)("div",{className:"flex flex-col sm:flex-row w-full items-center sm:space-x-16",children:[Object(X.jsx)(l.Controller,{control:r,name:"details.".concat(t,".productName"),render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({disabled:!0},t),{},{className:"mt-8 mb-16 w-full",label:i("PRODUCT_NAME_LABEL"),id:"productName",variant:"outlined",autoFocus:!0}))}}),Object(X.jsx)(l.Controller,{name:"details.".concat(t,".quantity"),control:r,render:function(e){var a=e.field;return Object(X.jsx)(C.a,{value:a.value.toLocaleString(),disabled:d===A.a.REVIEW_MODE,onChange:function(e){var n=e.target.value;n=n.replaceAll(",","");var r=parseFloat(n);r||(r=0),r>j&&(r=0),a.onChange(r);var o=c("details.".concat(t,".price")),i=parseFloat(o)*r;i&&u(i)},className:"mt-8 mb-16  w-full",label:i("QUANTITY_LABEL"),id:"pricePerMass",InputProps:{endAdornment:d===A.a.NEW_MODE?Object(X.jsx)(E.a,{position:"end",children:"< ".concat(j)}):void 0},type:"number",variant:"outlined"})}}),Object(X.jsx)(l.Controller,{name:"details.".concat(t,".price"),control:r,render:function(e){var a=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},a),{},{value:a.value.toLocaleString(),inputMode:"numeric",disabled:d===A.a.REVIEW_MODE,onChange:function(e){var n=e.target.value;n=n.replaceAll(",","");var r=parseFloat(n);r||(r=0),a.onChange(r);var o=c("details.".concat(t,".quantity")),i=r*parseFloat(o);i&&u(i)},className:"mt-8 mb-16 w-full",label:i("PRICE_LABEL"),id:"pricePerMass",InputProps:{lang:"en-US",startAdornment:Object(X.jsx)(E.a,{position:"start",children:s.cashUnitName})},variant:"outlined"}))}}),Object(X.jsx)(l.Controller,{name:"details.".concat(t,".totalCost"),control:r,render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},t),{},{value:t.value.toLocaleString(),inputMode:"numeric",disabled:!0,className:"mt-8 mb-16 w-full",label:i("TOTAL_COST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(E.a,{position:"start",children:s.cashUnitName})},variant:"outlined"}))}}),Object(X.jsx)(l.Controller,{name:"details.".concat(t,".description"),control:r,render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},t),{},{disabled:d===A.a.REVIEW_MODE,className:"mt-8 mb-16 w-full",id:"description",label:i("DESCRIPTION_LABEL"),type:"text",variant:"outlined",fullWidth:!0}))}}),d!==A.a.REVIEW_MODE&&Object(X.jsx)("div",{className:"flex flex-col w-1/9 mx-4 items-center justify-center",children:Object(X.jsx)(N.a,{className:"whitespace-nowrap mx-8 mt-8 mb-16",variant:"contained",color:"error",onClick:function(){e.handleRemoveRow(t)},startIcon:Object(X.jsx)(T.a,{className:"hidden sm:flex",children:"delete"}),children:i("REMOVE_BUTTON")})})]})})},se=Object(i.a)(s.a)((function(e){var t=e.theme;return{"& .FusePageCarded-header":Object(o.a)({minHeight:72,height:72,alignItems:"center"},t.breakpoints.up("sm"),{minHeight:96,height:96})}})),le=p.e().shape({customer:p.e().required(),details:p.a().min(1)});t.default=Object(O.a)("invoices",_.a)((function(){var e=Object(u.useState)(0),t=Object(c.a)(e,2),a=(t[0],t[1],Object(x.a)("invoices").t),o=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.invoice})),i=Object(j.j)(),s=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.products})),b=Object(x.a)("units").t,O=Object(v.useSelector)((function(e){return e.auth.user.shop})),p=Object(u.useState)(!0),_=Object(c.a)(p,2),y=_[0],D=_[1],R=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),F=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.customers})),U=Object(u.useState)(null),k=Object(c.a)(U,2),M=k[0],W=k[1],V=Object(u.useState)(!0),H=Object(c.a)(V,2),q=H[0],z=H[1],Y=Object(v.useDispatch)();Object(h.b)((function(){var e=i.invoiceId;"new"===e?(Y(Object(L.g)(A.a.NEW_MODE)),Y(Object(L.h)())):(Y(Object(L.g)(A.a.REVIEW_MODE)),console.log("get invoice",e),Y(Object(L.d)(e)))}),[i]);var K=Object(l.useForm)({mode:"onChange",defaultValues:{},resolver:Object(d.a)(le)}),J=K.watch,Q=K.reset,G=K.control,Z=K.formState,$=K.setValue,ee=K.getValues,te=(K.register,Object(l.useFieldArray)({control:G,name:"details"})),ae=te.append,ne=te.remove,re=te.fields;Z.errors;Object(u.useEffect)((function(){Q(o)}),[Q,o]),Object(u.useEffect)((function(){Y(Object(L.c)()).then((function(){D(!1)})),Y(Object(L.e)()).then((function(){z(!1)}))}),[Y]);var ce=J(),de=J("customer"),ue=function(e){ne(e)};return m.a.isEmpty(ce)?Object(X.jsx)(f.a,{}):Object(X.jsx)(l.FormProvider,Object(n.a)(Object(n.a)({},K),{},{children:Object(X.jsx)(se,{innerScroll:!0,header:Object(X.jsx)(oe,{}),content:Object(X.jsxs)("div",{className:"p-16 sm:p-24 w-full",children:[Object(X.jsxs)("div",{className:"flex flex-col sm:flex-row w-full items-center sm:space-x-16",children:[Object(X.jsx)(l.Controller,{name:"customer",control:G,render:function(e){var t=e.field,c=t.onChange,o=t.value;return Object(X.jsx)(g.a,{loading:y,disabled:R===A.a.REVIEW_MODE,className:"mt-8 mb-16",disablePortal:!0,fullWidth:!0,getOptionLabel:function(e){if(e.id>0){var t=e.name;return e.phone?t+=" | ".concat(e.phonePrefix).concat(e.phone):e.address&&(t+=" | ".concat(e.address)),t+=" | ".concat(e.isFamiliar?a("FAMILIAR_CUSTOMER"):a("PASSERSBY_CUSTOMER"))}return e.name},filterOptions:function(e,t){console.log("state",t);var n=[],r=t.inputValue;return e.forEach((function(e){var a,r,c;"".concat(null!==(a=e.name)&&void 0!==a?a:"").concat(null!==(r=e.phone)&&void 0!==r?r:"").concat(null!==(c=e.address)&&void 0!==c?c:"").toLowerCase().includes(t.inputValue.toLowerCase())&&n.push(e)})),""!==r&&0===n.length&&n.push({id:0,inputValue:r,name:"".concat(a("ADD_BUTTON"),' "').concat(r,'"')}),n},isOptionEqualToValue:function(e,t){return e.id===t.id},options:Object(r.a)(F),value:o,onChange:function(e,t){0===t.id?Y(Object(I.c)({children:Object(X.jsx)(B.b,{customer:{id:0,address:"",name:t.inputValue,phone:"",isFamiliar:!1},createCustomer:function(e){Object(P.b)(e).then((function(e){Y(Object(I.a)()),D(!0),Y(Object(L.c)()).then((function(){D(!1)}))}))}})})):($("customerDebt",t.debt),c(t))},renderInput:function(e){return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},e),{},{placeholder:a("SELECT_CUSTOMER_PLACE_HOLDER"),label:a("CUSTOMER_LABEL"),variant:"outlined",InputLabelProps:{shrink:!0},InputProps:Object(n.a)(Object(n.a)({},e.InputProps),{},{endAdornment:Object(X.jsxs)(X.Fragment,{children:[y?Object(X.jsx)(S.a,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}})}}),Object(X.jsx)(l.Controller,{name:"customerDebt",control:G,render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({disabled:!0},t),{},{value:t.value.toLocaleString(),className:"mt-8 mb-16",label:a("DEBT_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(E.a,{position:"start",children:O.cashUnitName})},variant:"outlined",fullWidth:!0}))}})]}),Object(X.jsxs)("div",{className:"flex flex-col sm:flex-row w-full sm:space-x-16",children:[R!==A.a.REVIEW_MODE&&Object(X.jsx)(N.a,{className:"whitespace-nowrap mt-8 mb-16 sm:w-1/4 w-full",variant:"contained",color:"primary",onClick:function(){var e=ee("totalCost"),t=ee("customerDebt"),a=e;$("deposit",a),$("rest",e+t-a)},children:a("PAY_ALL_BUTTON")}),Object(X.jsx)(l.Controller,{name:"deposit",control:G,render:function(e){var t=e.field;return Object(X.jsx)(C.a,{value:t.value.toLocaleString(),inputMode:"numeric",disabled:R===A.a.REVIEW_MODE,onChange:function(e){var a=e.target.value;a=a.replaceAll(",","");var n=parseFloat(a);n||(n=0),t.onChange(n);var r=ee("totalCost"),c=ee("customerDebt");$("rest",r+c-n)},className:"mt-8 mb-16",label:a("DEPOSIT_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(E.a,{position:"start",children:O.cashUnitName})},variant:"outlined",fullWidth:!0})}}),Object(X.jsx)(l.Controller,{name:"totalCost",control:G,render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},t),{},{value:t.value.toLocaleString(),disabled:!0,className:"mt-8 mb-16",label:a("TOTAL_COST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(E.a,{position:"start",children:O.cashUnitName})},variant:"outlined",fullWidth:!0}))}}),Object(X.jsx)(l.Controller,{name:"rest",control:G,render:function(e){var t=e.field;return Object(X.jsx)(C.a,{value:t.value.toLocaleString(),inputMode:"numeric",disabled:!0,onChange:function(e){},className:"mt-8 mb-16",label:a("REST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(E.a,{position:"start",children:O.cashUnitName})},variant:"outlined",fullWidth:!0})}})]}),de&&Object(X.jsxs)("div",{className:"flex w-full",children:[Object(X.jsx)(g.a,{className:"mt-8 mb-16 flex-1",disablePortal:!0,disabled:R===A.a.REVIEW_MODE,options:Object(r.a)(s),value:M,onChange:function(e,t){W(t)},getOptionDisabled:function(e){return e.inventoryNumber<=0},getOptionLabel:function(e){return"".concat(e.name," (").concat(e.inventoryNumber,")")},renderOption:function(e,t){return Object(X.jsxs)(w.a,Object(n.a)(Object(n.a)({component:"li",sx:{"& > img":{mr:2,flexShrink:0}}},e),{},{children:[Object(X.jsx)("img",{loading:"lazy",width:"20",src:t.thumbnail,srcSet:t.thumbnail,alt:""}),"".concat(t.name," (").concat(t.inventoryNumber,")")]}))},loading:q,renderInput:function(e){return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},e),{},{placeholder:a("SELECT_PRODUCT_PLACE_HOLDER"),label:a("PRODUCT_LABEL"),variant:"outlined",InputLabelProps:{shrink:!0},InputProps:Object(n.a)(Object(n.a)({},e.InputProps),{},{endAdornment:Object(X.jsxs)(X.Fragment,{children:[q?Object(X.jsx)(S.a,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}),R!==A.a.REVIEW_MODE&&Object(X.jsx)(N.a,{className:"whitespace-nowrap mx-8 mt-8 mb-16",variant:"contained",color:"primary",onClick:function(){var e;M&&(console.log("select",M),m.a.find(re,(function(e){return e.productId===M.id}))||(console.log("selected product",M),ae({productId:M.id,inventoryNumber:M.inventoryNumber,description:"",quantity:0,originalPrice:null!==(e=M.originalPrice)&&void 0!==e?e:0,price:de.isFamiliar&&M.priceForFamiliarCustomer?M.priceForFamiliarCustomer:M.priceForCustomer,productName:"".concat(M.name," | ").concat(b(M.unitName.toUpperCase())),totalCost:0}),W(null)))},startIcon:Object(X.jsx)(T.a,{className:"hidden sm:flex",children:"add"}),children:a("ADD_BUTTON")})]}),re.map((function(e,t){return Object(X.jsx)(ie,{index:t,handleRemoveRow:ue},t)}))]})})}))}))}}]);