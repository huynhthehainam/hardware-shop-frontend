(this["webpackJsonpfuse-react-app"]=this["webpackJsonpfuse-react-app"]||[]).push([[127],{1390:function(e,t,a){"use strict";a.d(t,"a",(function(){return L}));var n=a(101),r=a(4),c=a(54),i=a(14),o=a(6),s=a(1),l=a(1294),d=a(51),u=a(1377),j=a(41),b=a(15),m=a(0);var O=function(e){var t=Object(d.a)(),a=Object(b.useSelector)(Object(j.c)(t.palette.primary.main));return Object(m.jsx)("div",{className:"FusePageCarded-header",children:e.header&&Object(m.jsx)(u.a,{theme:a,children:e.header})})},h=a(8),p=a(17),f=a(133),x=a(1374),v=a(1378);var g=function(e){var t=Object(d.a)(),a=Object(b.useSelector)(Object(j.c)(t.palette.primary.main));return Object(m.jsxs)(m.Fragment,{children:[e.header&&Object(m.jsx)(u.a,{theme:a,children:Object(m.jsx)("div",{className:Object(o.default)("FusePageCarded-sidebarHeader",e.variant),children:e.header})}),e.content&&Object(m.jsx)(c.default,{className:"FusePageCarded-sidebarContent",enable:e.innerScroll,children:e.content})]})};function C(e,t){var a=Object(s.useState)(!1),n=Object(p.a)(a,2),r=n[0],c=n[1];Object(s.useImperativeHandle)(t,(function(){return{toggleSidebar:i}}));var i=function(){c(!r)};return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(x.a,{lgUp:"permanent"===e.variant,children:Object(m.jsx)(v.a,{variant:"temporary",anchor:e.position,open:r,onOpen:function(e){},onClose:function(e){return i()},disableSwipeToOpen:!0,classes:{root:Object(o.default)("FusePageCarded-sidebarWrapper",e.variant),paper:Object(o.default)("FusePageCarded-sidebar",e.variant,"left"===e.position?"FusePageCarded-leftSidebar":"FusePageCarded-rightSidebar")},ModalProps:{keepMounted:!0},container:e.rootRef.current,BackdropProps:{classes:{root:"FusePageCarded-backdrop"}},style:{position:"absolute"},children:Object(m.jsx)(g,Object(h.a)({},e))})}),"permanent"===e.variant&&Object(m.jsx)(x.a,{lgDown:!0,children:Object(m.jsx)(f.a,{variant:"permanent",className:Object(o.default)("FusePageCarded-sidebarWrapper",e.variant),open:r,classes:{paper:Object(o.default)("FusePageCarded-sidebar",e.variant,"left"===e.position?"FusePageCarded-leftSidebar":"FusePageCarded-rightSidebar")},children:Object(m.jsx)(g,Object(h.a)({},e))})})]})}var E,N=Object(s.forwardRef)(C),S=Object(i.a)("div")((function(e){var t=e.theme;return{display:"flex",flexDirection:"row",minWidth:0,minHeight:"100%",position:"relative",flex:"1 1 auto",width:"100%",height:"auto",backgroundColor:t.palette.background.default,"& .FusePageCarded-innerScroll":{height:"100%"},"& .FusePageCarded-topBg":{position:"absolute",left:0,right:0,top:0,height:P,background:"linear-gradient(to right, ".concat(t.palette.primary.dark," 0%, ").concat(t.palette.primary.main," 100%)"),backgroundSize:"cover",pointerEvents:"none"},"& .FusePageCarded-contentWrapper":Object(r.a)({display:"flex",flexDirection:"column",padding:"0 3.2rem",flex:"1 1 100%",zIndex:2,maxWidth:"100%",minWidth:0,minHeight:0},t.breakpoints.down("sm"),{padding:"0 1.6rem"}),"& .FusePageCarded-header":{height:w,minHeight:w,maxHeight:w,display:"flex",color:t.palette.primary.contrastText},"& .FusePageCarded-headerSidebarToggleButton":{color:t.palette.primary.contrastText},"& .FusePageCarded-contentCard":{display:"flex",flex:"1 1 100%",flexDirection:"column",backgroundColor:t.palette.background.paper,boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",minHeight:0,borderRadius:"20px 20px 0 0"},"& .FusePageCarded-toolbar":{height:T,minHeight:T,display:"flex",alignItems:"center",borderBottom:"1px solid ".concat(t.palette.divider)},"& .FusePageCarded-content":{flex:"1 1 auto",height:"100%",overflow:"auto",WebkitOverflowScrolling:"touch"},"& .FusePageCarded-sidebarWrapper":{position:"absolute",backgroundColor:"transparent",zIndex:5,overflow:"hidden","&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{zIndex:1,position:"relative"})},"& .FusePageCarded-sidebar":{position:"absolute","&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{backgroundColor:"transparent",position:"relative",border:"none",overflow:"hidden"}),width:I,height:"100%"},"& .FusePageCarded-leftSidebar":{},"& .FusePageCarded-rightSidebar":{},"& .FusePageCarded-sidebarHeader":{height:P,minHeight:P,color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.dark,"&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{backgroundColor:"transparent"})},"& .FusePageCarded-sidebarContent":Object(r.a)({display:"flex",flex:"1 1 auto",flexDirection:"column",backgroundColor:t.palette.background.default,color:t.palette.text.primary},t.breakpoints.up("lg"),{overflow:"auto",WebkitOverflowScrolling:"touch"}),"& .FusePageCarded-backdrop":{position:"absolute"}}})),I=240,P=200,T=64,w=P-T,_=Object(s.forwardRef)((function(e,t){var a=Object(s.useRef)(null),n=Object(s.useRef)(null),r=Object(s.useRef)(null),i=e.rightSidebarHeader||e.rightSidebarContent,d=e.leftSidebarHeader||e.leftSidebarContent;return Object(s.useImperativeHandle)(t,(function(){return{rootRef:r,toggleLeftSidebar:function(){a.current.toggleSidebar()},toggleRightSidebar:function(){n.current.toggleSidebar()}}})),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(l.a,{styles:function(t){return{"#fuse-main":{height:e.innerScroll&&"100vh"}}}}),Object(m.jsxs)(S,{className:Object(o.default)("FusePageCarded-root",e.innerScroll&&"FusePageCarded-innerScroll",e.className),ref:r,children:[Object(m.jsx)("div",{className:"FusePageCarded-topBg"}),Object(m.jsxs)("div",{className:"flex container w-full",children:[d&&Object(m.jsx)(N,{position:"left",header:e.leftSidebarHeader,content:e.leftSidebarContent,variant:e.leftSidebarVariant||"permanent",innerScroll:e.innerScroll,ref:a,rootRef:r}),Object(m.jsxs)("div",{className:Object(o.default)("FusePageCarded-contentWrapper",d&&(void 0===e.leftSidebarVariant||"permanent"===e.leftSidebarVariant)&&"lg:ltr:pl-0 lg:rtl:pr-0",i&&(void 0===e.rightSidebarVariant||"permanent"===e.rightSidebarVariant)&&"lg:pr-0"),children:[Object(m.jsx)(O,{header:e.header}),Object(m.jsxs)("div",{className:Object(o.default)("FusePageCarded-contentCard",e.innerScroll&&"inner-scroll"),children:[e.contentToolbar&&Object(m.jsx)("div",{className:"FusePageCarded-toolbar",children:e.contentToolbar}),e.content&&Object(m.jsx)(c.default,{className:"FusePageCarded-content",enable:e.innerScroll,scrollToTopOnRouteChange:e.innerScroll,children:e.content})]})]}),i&&Object(m.jsx)(N,{position:"right",header:e.rightSidebarHeader,content:e.rightSidebarContent,variant:e.rightSidebarVariant||"permanent",innerScroll:e.innerScroll,ref:n,rootRef:r})]})]})]})}));_.defaultProps={};var L=Object(s.memo)(Object(i.a)(_)(E||(E=Object(n.a)([""]))))},1649:function(e,t,a){"use strict";a.d(t,"b",(function(){return _})),a.d(t,"a",(function(){return L}));var n=a(86),r=a(8),c=a(17),i=a(1335),o=a(767),s=a(776),l=a(1331),d=a(1347),u=a(1),j=a(47),b=a(1375),m=a(15),O=a(1336),h=a(1467),p=a(1466),f=a(1498),x=a(318),v=a(76),g=a(189),C=a(1333),E=a(1334),N=a(55),S=a(331),I=a.n(S),P=a(322),T=a(0),w=v.e().shape({name:v.g().required(),phone:v.g().length(9),address:v.g(),isFamiliar:v.b()}),_=function(e){var t=e.customer,a=Object(m.useDispatch)(),n=Object(j.useForm)({mode:"onChange",defaultValues:{},resolver:Object(g.a)(w)}),v=Object(u.useState)([]),S=Object(c.a)(v,2),_=S[0],L=S[1],y=Object(b.a)("invoices").t,A=n.control,D=n.formState,R=(n.setValue,n.reset),F=n.watch,U=n.getValues,k=D.errors;Object(u.useEffect)((function(){Object(N.b)().then((function(e){L(e)}))}),[L,R]),Object(u.useEffect)((function(){if(_.length>0)if(t){var e,a=Object(r.a)({},t);a.phoneCountryId=null!==(e=a.phoneCountryId)&&void 0!==e?e:_[0].id,R(a)}else R({id:0,name:"",phone:"",address:"",isFamiliar:!1,phoneCountryId:_[0].id})}),[t,_,R]);var B=F();return I.a.isEmpty(B)?Object(T.jsx)(T.Fragment,{children:Object(T.jsx)(p.a,{children:Object(T.jsx)(P.a,{})})}):Object(T.jsxs)(j.FormProvider,Object(r.a)(Object(r.a)({},n),{},{children:[Object(T.jsx)(f.a,{id:"alert-dialog-title",children:y("CREATE_CUSTOMER_TITLE",{name:B.name})}),Object(T.jsxs)(p.a,{children:[Object(T.jsx)(j.Controller,{name:"name",control:A,render:function(e){var t=e.field;return Object(T.jsx)(i.a,Object(r.a)(Object(r.a)({},t),{},{className:"mt-8 mb-16",error:!!k.name,required:!0,label:y("CUSTOMER_NAME_LABEL"),autoFocus:!0,id:"name",variant:"outlined",fullWidth:!0}))}}),Object(T.jsxs)("div",{className:"flex w-full mt-8 mb-16",children:[Object(T.jsx)(j.Controller,{name:"phoneCountryId",control:A,render:function(e){var t=e.field;return Object(T.jsx)(o.a,{className:"w-1/5",children:Object(T.jsx)(s.a,{id:"phone-country-select",value:t.value,onChange:function(e){t.onChange(e.target.value)},children:_.map((function(e,t){return Object(T.jsx)(l.a,{value:e.id,children:Object(T.jsx)("img",{className:"max-w-none w-auto h-20",src:e.logoUrl,alt:"product"})},e.id)}))})})}}),Object(T.jsx)(j.Controller,{name:"phone",control:A,render:function(e){var t=e.field;return Object(T.jsx)(i.a,Object(r.a)(Object(r.a)({},t),{},{className:"ml-8 flex-1",error:!!k.phone,required:!0,label:y("CUSTOMER_PHONE_LABEL"),id:"phone",variant:"outlined",fullWidth:!0,InputProps:{startAdornment:Object(T.jsx)(d.a,{position:"start",children:I.a.find(_,(function(e){return e.id===B.phoneCountryId})).phonePrefix})}}))}})]}),Object(T.jsx)(j.Controller,{name:"address",control:A,render:function(e){var t=e.field;return Object(T.jsx)(i.a,Object(r.a)(Object(r.a)({},t),{},{className:"mt-8 mb-16",error:!!k.address,required:!0,label:y("CUSTOMER_ADDRESS_LABEL"),id:"address",variant:"outlined",fullWidth:!0}))}}),Object(T.jsx)(j.Controller,{name:"isFamiliar",control:A,render:function(e){var t=e.field,a=t.onChange,n=t.value;return Object(T.jsx)(C.a,{className:"mt-8 mb-16",label:y("CUSTOMER_IS_FAMILIAR_LABEL"),control:Object(T.jsx)(E.a,{onChange:function(e){a(e.target.checked)},checked:n,name:"hasAutoCalculatePermission"})})}})]}),Object(T.jsxs)(h.a,{children:[Object(T.jsx)(O.a,{onClick:function(){return a(Object(x.a)())},color:"error",children:y("CANCEL_BUTTON")}),Object(T.jsx)(O.a,{onClick:function(){var t=U();console.log("create customer data",t),0===t.id?e.createCustomer(t):e.updateCustomer(t)},color:"secondary",children:y("SAVE_BUTTON")})]})]}))},L=function(e){var t=e.title,a=e.content,n=e.onAccept,r=Object(m.useDispatch)(),c=Object(b.a)("common").t;return Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)(f.a,{children:t}),Object(T.jsx)(p.a,{children:a}),Object(T.jsxs)(h.a,{children:[Object(T.jsx)(O.a,{onClick:function(){return r(Object(x.a)())},color:"error",children:c("CANCEL_BUTTON")}),Object(T.jsx)(O.a,{onClick:function(){n()},color:"primary",children:c("OK_BUTTON")})]})]})},y={},A={OK_BUTTON:"\u0110\u1ed3ng \xfd",CANCEL_BUTTON:"Hu\u1ef7"};n.a.addResourceBundle("en","common",y),n.a.addResourceBundle("vi","common",A)},1665:function(e,t,a){"use strict";t.a={THUMBNAIL_ASSET_TYPE:"thumbnail",SLIDE_ASSET_TYPE:"slide",NEW_MODE:"new",UPDATE_MODE:"update",REVIEW_MODE:"review"}},1695:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return d})),a.d(t,"e",(function(){return u})),a.d(t,"f",(function(){return j}));var n=a(55),r=a(37),c=r.createSlice,i=(0,r.createAsyncThunk)("invoices/invoices/getInvoices",(function(e,t){var a=t.dispatch,r=t.getState;return new Promise((function(e,t){var c=r().invoices.invoices.page,i=r().invoices.invoices.rowsPerPage,o=r().invoices.invoices,s=o.searchText,l=o.order;n.a.get(n.c.getInvoices,{params:{pageIndex:c,pageSize:i,search:s,sortFieldName:l.id,isSortAscending:"asc"===l.direction}}).then((function(t){a(m(t.data.data)),a(b(t.data.totalItems)),e()}))}))})),o=c({initialState:{searchText:"",data:[],order:{id:"code",direction:"asc"},totalRecords:0,rowsPerPage:5,page:0},name:"invoices",reducers:{resetState:function(e,t){},setTotalRecords:function(e,t){e.totalRecords=t.payload},setData:function(e,t){e.data=t.payload},setInvoiceSearchText:function(e,t){e.searchText=t.payload},setOrder:function(e,t){e.order=t.payload},setPage:function(e,t){e.page=t.payload},setRowsPerPage:function(e,t){e.rowsPerPage=t.payload}}}),s=o.actions,l=(s.resetState,s.setInvoiceSearchText),d=s.setOrder,u=s.setPage,j=s.setRowsPerPage,b=s.setTotalRecords,m=s.setData;t.a=o.reducer},1696:function(e,t,a){"use strict";a.d(t,"c",(function(){return d})),a.d(t,"e",(function(){return u})),a.d(t,"a",(function(){return j})),a.d(t,"d",(function(){return b})),a.d(t,"f",(function(){return m})),a.d(t,"h",(function(){return f})),a.d(t,"g",(function(){return x}));var n=a(8),r=a(55),c=a(516),i=a(1665),o=a(37),s=o.createSlice,l=o.createAsyncThunk,d=l("invoices/createUpdateInvoice/getCustomers",(function(e,t){var a=t.dispatch;return new Promise((function(e,t){r.a.get(r.c.getCustomers).then((function(t){var n=t.data.data;a(p(n)),e()}))}))})),u=l("invoices/createUpdateInvoice/getProducts",(function(e,t){var a=t.dispatch;return new Promise((function(e,t){Object(c.i)().then((function(t){a(v(t)),e();var r=t.map((function(e){return new Promise((function(t){Object(c.f)(e.id).then((function(a){var r=Object(n.a)({},e);r.thumbnail=a,t(r)}))}))}));Promise.all(r).then((function(e){a(v(e))}))}))}))})),j=l("invoices/createUpdateInvoice/createInvoice",(function(e,t){t.dispatch,t.getState;return new Promise((function(t,a){r.a.post(r.c.createInvoice,e).then((function(e){t(e.data.data)})).catch((function(e){a()}))}))})),b=l("invoices/createUpdateInvoice/getInvoiceById",(function(e,t){var a=t.dispatch;t.getState;return new Promise((function(t,n){r.a.get(r.c.getInvoiceById(e)).then((function(e){var n=e.data.data,r={id:n.id,customer:{id:n.customerId,name:n.customerName,phone:n.customerPhone,address:n.customerAddress,phonePrefix:n.customerPhonePrefix},code:"",date:n.createdDate,customerDebt:n.debt,totalCost:n.totalCost,deposit:n.deposit,rest:n.rest,details:n.details.map((function(e){return{productId:e.productId,description:e.description,quantity:e.quantity,originalPrice:e.originalPrice,price:e.price,productName:"".concat(e.productName," | ").concat(e.unitName),totalCost:e.totalCost}}))};a(g(r)),t()}))}))})),m=l("invoices/createUpdateInvoice/restoreInvoiceById",(function(e,t){var a=t.dispatch;t.getState;return new Promise((function(t,n){r.a.post(r.c.restoreInvoiceById(e)).then((function(e){a(x(i.a.NEW_MODE)),t()}))}))})),O=s({initialState:{customers:[],invoice:{},mode:i.a.NEW_MODE,products:[]},name:"createUpdateInvoice",reducers:{resetState:function(e,t){},setCustomers:function(e,t){e.customers=t.payload},setProducts:function(e,t){e.products=t.payload},setInvoice:function(e,t){e.invoice=t.payload},setNewInvoice:function(e,t){e.invoice={customer:null,code:"",date:new Date,customerDebt:0,totalCost:0,deposit:0,rest:0,details:[]}},setMode:function(e,t){e.mode=t.payload}}}),h=O.actions,p=(h.resetState,h.setCustomers),f=h.setNewInvoice,x=h.setMode,v=h.setProducts,g=h.setInvoice;t.b=O.reducer},1760:function(e,t,a){"use strict";var n=a(224),r=a(1),c=a(15).useDispatch;t.a=function(){var e=c();return{showNotification:Object(r.useCallback)((function(t){console.log("show notification",t),e(Object(n.b)(t))}),[e])}}},1763:function(e,t,a){"use strict";var n=a(160),r=a(1695),c=a(1696);t.a=Object(n.d)({invoices:r.a,createUpdateInvoice:c.b})},3409:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a(20),c=a(17),i=a(4),o=a(14),s=a(1390),l=a(47),d=a(189),u=a(1),j=a(66),b=a(331),m=a.n(b),O=a(191),h=a(128),p=a(76),f=a(322),x=a(1375),v=a(15),g=a(1662),C=a(1335),E=a(1513),N=a(1347),S=a(1336),I=a(1389),P=a(1327),T=a(318),w=a(516),_=a(1763),L=a(1665),y=a(1696),A=a(51),D=a(222),R=a(1372),F=a(43),U=a(1885),k=a(1760),B=a(170),M=a(1649),W=a(1346),V=a(1348),H=a(1520),q=a(1524),z=a(1523),Y=a(1521),J=a(1522),K=a(1467),Q=a(1466),G=a(1498),X=a(0),Z=Object(o.a)("div")((function(e){var t=e.theme;return{"& table ":{"& th:first-child, & td:first-child":{paddingLeft:"".concat(0,"!important")},"& th:last-child, & td:last-child":{paddingRight:"".concat(0,"!important")}},"& .divider":{width:1,backgroundColor:t.palette.divider,height:144},"& .seller":{backgroundColor:t.palette.primary.dark,color:t.palette.getContrastText(t.palette.primary.dark),marginRight:-88,paddingRight:66,width:480,"& .divider":{backgroundColor:t.palette.getContrastText(t.palette.primary.dark),opacity:.5}}}})),$=function(e){var t=e.formContext,a=Object(x.a)("invoices").t,n=Object(v.useSelector)((function(e){return e.auth.user.shop})),r=(t.control,(0,t.watch)()),c=Object(v.useDispatch)();return console.log("invoice",r),Object(X.jsxs)(X.Fragment,{children:[Object(X.jsx)(G.a,{id:"alert-dialog-title",children:a("PREVIEW_INVOICE_TITLE",{customerName:r.customer.name})}),Object(X.jsx)(Q.a,{children:Object(X.jsx)(Z,{className:"flex-grow flex-shrink-0 p-0",children:Object(X.jsx)(W.a,{className:"w-xl mx-auto shadow-0",children:Object(X.jsxs)(V.a,{className:"p-20 print:p-0",children:[Object(X.jsxs)("div",{className:"flex justify-between",children:[Object(X.jsxs)("div",{children:[Object(X.jsx)("table",{className:"mb-8",children:Object(X.jsx)("tbody",{children:Object(X.jsxs)("tr",{children:[Object(X.jsx)("td",{className:"pb-4",children:Object(X.jsx)(D.a,{className:"font-light",variant:"h6",color:"textSecondary",children:a("INVOICE_PDF_HEADER")})}),Object(X.jsx)("td",{className:"pb-4 px-8",children:Object(X.jsx)(D.a,{className:"font-light",variant:"h6",color:"inherit",children:r.code})})]})})}),Object(X.jsx)(D.a,{color:"textSecondary",children:r.customer&&r.customer.name}),Object(X.jsx)(D.a,{color:"textSecondary",children:r.customer&&r.customer.phone}),Object(X.jsx)(D.a,{color:"textSecondary",children:r.customer&&r.customer.address}),Object(X.jsxs)(D.a,{color:"textSecondary",children:[a("TOTAL_COST_LABEL"),": ",r.totalCost.toLocaleString()," ",n.cashUnitName]}),Object(X.jsx)(D.a,{color:"textSecondary",children:r.customerDebt>0&&"".concat(a("DEBT_LABEL"),": ").concat(r.customerDebt.toLocaleString()," ").concat(n.cashUnitName)}),Object(X.jsxs)(D.a,{color:"textSecondary",children:[a("DEPOSIT_LABEL"),": ",r.deposit.toLocaleString()," ",n.cashUnitName]}),Object(X.jsxs)(D.a,{color:"textSecondary",children:[a("REST_LABEL"),": ",r.rest.toLocaleString()," ",n.cashUnitName]})]}),Object(X.jsxs)("div",{className:"seller flex items-center p-16",children:[Object(X.jsx)("img",{className:"w-80",src:n.logoUrl,alt:"logo"}),Object(X.jsx)("div",{className:"divider mx-8 h-96"}),Object(X.jsxs)("div",{className:"px-8",children:[Object(X.jsxs)(D.a,{color:"inherit",children:[n.name,"."]}),Object(X.jsx)(D.a,{color:"inherit",children:n.address}),n.phones&&n.phones.map((function(e,t){return Object(X.jsx)(D.a,{color:"inherit",children:"".concat(e.ownerName," (").concat(e.phonePrefix).concat(e.phone,")")},t)})),n.emails&&n.emails.map((function(e){return Object(X.jsx)(D.a,{color:"inherit",children:e})}))]})]})]}),Object(X.jsx)("div",{className:"mt-6",children:Object(X.jsxs)(H.a,{className:"simple",children:[Object(X.jsx)(Y.a,{children:Object(X.jsxs)(J.a,{children:[Object(X.jsx)(z.a,{children:a("PRODUCT_LABEL")}),Object(X.jsx)(z.a,{align:"right",children:a("PRICE_LABEL")}),Object(X.jsx)(z.a,{align:"right",children:a("QUANTITY_LABEL")}),Object(X.jsx)(z.a,{align:"right",children:a("TOTAL_COST_LABEL")})]})}),Object(X.jsx)(q.a,{children:r.details.map((function(e,t){return Object(X.jsxs)(J.a,{children:[Object(X.jsxs)(z.a,{children:[Object(X.jsx)(D.a,{variant:"subtitle1",children:e.productName}),Object(X.jsx)(D.a,{children:e.description})]}),Object(X.jsx)(z.a,{align:"right",children:"".concat(e.price.toLocaleString()," ").concat(n.cashUnitName)}),Object(X.jsx)(z.a,{align:"right",children:e.quantity}),Object(X.jsx)(z.a,{align:"right",children:"".concat(e.totalCost.toLocaleString()," ").concat(n.cashUnitName)})]},t)}))})]})})]})})})}),Object(X.jsx)(K.a,{children:Object(X.jsx)(S.a,{onClick:function(){return c(Object(T.a)())},color:"error",children:a("CANCEL_BUTTON")})})]})},ee=function(){var e=Object(u.useState)(!1),t=Object(c.a)(e,2),a=t[0],n=t[1],r=Object(u.useState)(!1),i=Object(c.a)(r,2),o=i[0],s=i[1],d=Object(v.useDispatch)(),b=Object(l.useFormContext)(),m=b.formState,O=b.watch,h=b.getValues,p=(b.handleSubmit,m.isValid),f=(m.dirtyFields,m.errors,Object(x.a)("invoices").t),g=O("customer"),C=Object(A.a)(),E=Object(j.h)(),N=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),I=Object(k.a)().showNotification,_=Object(v.useSelector)((function(e){return e.i18n.language})),W=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=h();n(!0);var a={customerId:t.customer.id,deposit:t.deposit,details:t.details.map((function(e){return{productId:e.productId,quantity:e.quantity,price:e.price,description:e.description,originalPrice:e.originalPrice}}))};console.log("validated data",a),d(Object(y.a)(a)).then((function(t){if(e){var a=t.payload.id;Object(w.e)(a,_).then((function(e){B.a.downloadUrl(e),I({translation:"CREATE_SUCCESSFULLY",options:{variant:"success"}}),n(!1),E.push("/apps/invoices")}))}else I({translation:"CREATE_SUCCESSFULLY",options:{variant:"success"}}),n(!1),E.push("/apps/invoices")})).catch((function(e){n(!1)}))};return Object(X.jsxs)("div",{className:"flex flex-1 w-full items-center justify-between",children:[Object(X.jsxs)("div",{className:"flex flex-col items-start max-w-full min-w-0",children:[Object(X.jsx)(R.a.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1,transition:{delay:.3}},children:Object(X.jsxs)(D.a,{className:"flex items-center sm:mb-12",component:F.a,role:"button",to:"/apps/invoices",color:"inherit",children:[Object(X.jsx)(P.a,{className:"text-20",children:"ltr"===C.direction?"arrow_back":"arrow_forward"}),Object(X.jsx)("span",{className:"hidden sm:flex mx-4 font-medium",children:f("MANAGE_INVOICES_LABEL")})]})}),Object(X.jsx)("div",{className:"flex items-center max-w-full",children:Object(X.jsx)("div",{className:"flex flex-col min-w-0 mx-8 sm:mc-16",children:Object(X.jsxs)(R.a.div,{initial:{x:-20},animate:{x:0,transition:{delay:.3}},children:[Object(X.jsx)(D.a,{className:"text-16 sm:text-20 truncate font-semibold",children:f("NEW_INVOICE_LABEL",{customerName:g?g.name:""})}),Object(X.jsx)(D.a,{variant:"caption",className:"font-medium",children:f("INVOICE_DETAIL")})]})})})]}),Object(X.jsxs)(R.a.div,{className:"flex",initial:{opacity:0,x:20},animate:{opacity:1,x:0,transition:{delay:.3}},children:[N===L.a.REVIEW_MODE&&Object(X.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:o,color:"warning",onClick:function(){d(Object(T.c)({maxWidth:"xs",fullWidth:!0,children:Object(X.jsx)(M.a,{title:f("RESTORE_INVOICE_TITLE"),content:f("RESTORE_INVOICE_CONTENT"),onAccept:function(){var e=h();s(!0),d(Object(y.f)(e.id)).then((function(){s(!1)})),d(Object(T.a)())}})}))},startIcon:Object(X.jsx)(P.a,{className:"hidden sm:flex",children:"restore"}),children:f("RESTORE_BUTTON")}),N===L.a.REVIEW_MODE&&Object(X.jsx)(S.a,{className:"whitespace-nowrap mx-4",variant:"contained",color:"secondary",onClick:function(){var e=h();Object(w.e)(e.id,_).then((function(e){B.a.downloadUrl(e)}))},startIcon:Object(X.jsx)(P.a,{className:"hidden sm:flex",children:"download"}),children:f("DOWNLOAD_BUTTON")}),(N===L.a.UPDATE_MODE||N===L.a.NEW_MODE)&&Object(X.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:a,color:"secondary",disabled:!p,onClick:function(){W(!1)},children:f("SAVE_BUTTON")}),(N===L.a.UPDATE_MODE||N===L.a.NEW_MODE)&&Object(X.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:a,color:"secondary",disabled:!p,onClick:function(){W(!0)},children:f("SAVE_DOWNLOAD_BUTTON")}),(N===L.a.UPDATE_MODE||N===L.a.NEW_MODE)&&Object(X.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:a,color:"secondary",disabled:!p,onClick:function(){d(Object(T.c)({maxWidth:"lg",fullWidth:!0,children:Object(X.jsx)($,{formContext:b})}))},children:f("PREVIEW_BUTTON")})]})]})},te=function(e){var t=e.index,a=Object(l.useFormContext)(),r=a.control,c=(a.watch,a.getValues),i=a.setValue,o=Object(x.a)("invoices").t,s=Object(v.useSelector)((function(e){return e.auth.user.shop})),d=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),u=Object(h.a)((function(e){B.a.convertUnitValue(s.cashUnitId,e).then((function(e){i("details.".concat(t,".totalCost"),e);var a=c("details"),n=0;a.forEach((function(e){n+=e.totalCost})),i("totalCost",n);var r=c("deposit"),o=c("customerDebt");i("rest",n+o-r)}))}),500),j=c("details.".concat(t,".inventoryNumber"));return Object(X.jsx)("div",{className:"flex w-full",children:Object(X.jsxs)("div",{className:"flex flex-col sm:flex-row w-full items-center sm:space-x-16",children:[Object(X.jsx)(l.Controller,{control:r,name:"details.".concat(t,".productName"),render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({disabled:!0},t),{},{className:"mt-8 mb-16 w-full",label:o("PRODUCT_NAME_LABEL"),id:"productName",variant:"outlined",autoFocus:!0}))}}),Object(X.jsx)(l.Controller,{name:"details.".concat(t,".quantity"),control:r,render:function(e){var a=e.field;return Object(X.jsx)(C.a,{value:a.value.toLocaleString(),disabled:d===L.a.REVIEW_MODE,onChange:function(e){var n=e.target.value;n=n.replaceAll(",","");var r=parseFloat(n);r||(r=0),r>j&&(r=0),a.onChange(r);var i=c("details.".concat(t,".price")),o=parseFloat(i)*r;o&&u(o)},className:"mt-8 mb-16  w-full",label:o("QUANTITY_LABEL"),id:"pricePerMass",InputProps:{endAdornment:d===L.a.NEW_MODE?Object(X.jsx)(N.a,{position:"end",children:"< ".concat(j)}):void 0},type:"number",variant:"outlined"})}}),Object(X.jsx)(l.Controller,{name:"details.".concat(t,".price"),control:r,render:function(e){var a=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},a),{},{value:a.value.toLocaleString(),inputMode:"numeric",disabled:d===L.a.REVIEW_MODE,onChange:function(e){var n=e.target.value;n=n.replaceAll(",","");var r=parseFloat(n);r||(r=0),a.onChange(r);var i=c("details.".concat(t,".quantity")),o=r*parseFloat(i);o&&u(o)},className:"mt-8 mb-16 w-full",label:o("PRICE_LABEL"),id:"pricePerMass",InputProps:{lang:"en-US",startAdornment:Object(X.jsx)(N.a,{position:"start",children:s.cashUnitName})},variant:"outlined"}))}}),Object(X.jsx)(l.Controller,{name:"details.".concat(t,".totalCost"),control:r,render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},t),{},{value:t.value.toLocaleString(),inputMode:"numeric",disabled:!0,className:"mt-8 mb-16 w-full",label:o("TOTAL_COST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(N.a,{position:"start",children:s.cashUnitName})},variant:"outlined"}))}}),Object(X.jsx)(l.Controller,{name:"details.".concat(t,".description"),control:r,render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},t),{},{disabled:d===L.a.REVIEW_MODE,className:"mt-8 mb-16 w-full",id:"description",label:o("DESCRIPTION_LABEL"),type:"text",variant:"outlined",fullWidth:!0}))}}),d!==L.a.REVIEW_MODE&&Object(X.jsx)("div",{className:"flex flex-col w-1/9 mx-4 items-center justify-center",children:Object(X.jsx)(S.a,{className:"whitespace-nowrap mx-8 mt-8 mb-16",variant:"contained",color:"error",onClick:function(){e.handleRemoveRow(t)},startIcon:Object(X.jsx)(P.a,{className:"hidden sm:flex",children:"delete"}),children:o("REMOVE_BUTTON")})})]})})},ae=Object(o.a)(s.a)((function(e){var t=e.theme;return{"& .FusePageCarded-header":Object(i.a)({minHeight:72,height:72,alignItems:"center"},t.breakpoints.up("sm"),{minHeight:96,height:96})}})),ne=p.e().shape({customer:p.e().required(),details:p.a().min(1)});t.default=Object(O.a)("invoices",_.a)((function(){var e=Object(u.useState)(0),t=Object(c.a)(e,2),a=(t[0],t[1],Object(x.a)("invoices").t),i=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.invoice})),o=Object(j.j)(),s=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.products})),b=Object(x.a)("units").t,O=Object(v.useSelector)((function(e){return e.auth.user.shop})),p=Object(u.useState)(!0),_=Object(c.a)(p,2),A=_[0],D=_[1],R=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),F=Object(v.useSelector)((function(e){return e.invoices.createUpdateInvoice.customers})),U=Object(u.useState)(null),k=Object(c.a)(U,2),B=k[0],W=k[1],V=Object(u.useState)(!0),H=Object(c.a)(V,2),q=H[0],z=H[1],Y=Object(v.useDispatch)();Object(h.b)((function(){var e=o.invoiceId;"new"===e?(Y(Object(y.g)(L.a.NEW_MODE)),Y(Object(y.h)())):(Y(Object(y.g)(L.a.REVIEW_MODE)),console.log("get invoice",e),Y(Object(y.d)(e)))}),[o]);var J=Object(l.useForm)({mode:"onChange",defaultValues:{},resolver:Object(d.a)(ne)}),K=J.watch,Q=J.reset,G=J.control,Z=J.formState,$=J.setValue,re=J.getValues,ce=(J.register,Object(l.useFieldArray)({control:G,name:"details"})),ie=ce.append,oe=ce.remove,se=ce.fields;Z.errors;Object(u.useEffect)((function(){Q(i)}),[Q,i]),Object(u.useEffect)((function(){Y(Object(y.c)()).then((function(){D(!1)})),Y(Object(y.e)()).then((function(){z(!1)}))}),[Y]);var le=K(),de=K("customer"),ue=function(e){oe(e)};return m.a.isEmpty(le)?Object(X.jsx)(f.a,{}):Object(X.jsx)(l.FormProvider,Object(n.a)(Object(n.a)({},J),{},{children:Object(X.jsx)(ae,{innerScroll:!0,header:Object(X.jsx)(ee,{}),content:Object(X.jsxs)("div",{className:"p-16 sm:p-24 w-full",children:[Object(X.jsxs)("div",{className:"flex flex-col sm:flex-row w-full items-center sm:space-x-16",children:[Object(X.jsx)(l.Controller,{name:"customer",control:G,render:function(e){var t=e.field,c=t.onChange,i=t.value;return Object(X.jsx)(g.a,{loading:A,disabled:R===L.a.REVIEW_MODE,className:"mt-8 mb-16",disablePortal:!0,fullWidth:!0,getOptionLabel:function(e){if(e.id>0){var t=e.name;return e.phone?t+=" | ".concat(e.phonePrefix).concat(e.phone):e.address&&(t+=" | ".concat(e.address)),t+=" | ".concat(e.isFamiliar?a("FAMILIAR_CUSTOMER"):a("PASSERSBY_CUSTOMER"))}return e.name},filterOptions:function(e,t){console.log("state",t);var n=[],r=t.inputValue;return e.forEach((function(e){var a,r,c;"".concat(null!==(a=e.name)&&void 0!==a?a:"").concat(null!==(r=e.phone)&&void 0!==r?r:"").concat(null!==(c=e.address)&&void 0!==c?c:"").toLowerCase().includes(t.inputValue.toLowerCase())&&n.push(e)})),""!==r&&0===n.length&&n.push({id:0,inputValue:r,name:"".concat(a("ADD_BUTTON"),' "').concat(r,'"')}),n},isOptionEqualToValue:function(e,t){return e.id===t.id},options:Object(r.a)(F),value:i,onChange:function(e,t){0===t.id?Y(Object(T.c)({children:Object(X.jsx)(M.b,{customer:{id:0,address:"",name:t.inputValue,phone:"",isFamiliar:!1},createCustomer:function(e){Object(w.b)(e).then((function(e){Y(Object(T.a)()),D(!0),Y(Object(y.c)()).then((function(){D(!1)}))}))}})})):($("customerDebt",t.debt),c(t))},renderInput:function(e){return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},e),{},{placeholder:a("SELECT_CUSTOMER_PLACE_HOLDER"),label:a("CUSTOMER_LABEL"),variant:"outlined",InputLabelProps:{shrink:!0},InputProps:Object(n.a)(Object(n.a)({},e.InputProps),{},{endAdornment:Object(X.jsxs)(X.Fragment,{children:[A?Object(X.jsx)(E.a,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}})}}),Object(X.jsx)(l.Controller,{name:"customerDebt",control:G,render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({disabled:!0},t),{},{value:t.value.toLocaleString(),className:"mt-8 mb-16",label:a("DEBT_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(N.a,{position:"start",children:O.cashUnitName})},variant:"outlined",fullWidth:!0}))}})]}),Object(X.jsxs)("div",{className:"flex flex-col sm:flex-row w-full sm:space-x-16",children:[R!==L.a.REVIEW_MODE&&Object(X.jsx)(S.a,{className:"whitespace-nowrap mt-8 mb-16 sm:w-1/4 w-full",variant:"contained",color:"primary",onClick:function(){var e=re("totalCost"),t=re("customerDebt"),a=e;$("deposit",a),$("rest",e+t-a)},children:a("PAY_ALL_BUTTON")}),Object(X.jsx)(l.Controller,{name:"deposit",control:G,render:function(e){var t=e.field;return Object(X.jsx)(C.a,{value:t.value.toLocaleString(),inputMode:"numeric",disabled:R===L.a.REVIEW_MODE,onChange:function(e){var a=e.target.value;a=a.replaceAll(",","");var n=parseFloat(a);n||(n=0),t.onChange(n);var r=re("totalCost"),c=re("customerDebt");$("rest",r+c-n)},className:"mt-8 mb-16",label:a("DEPOSIT_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(N.a,{position:"start",children:O.cashUnitName})},variant:"outlined",fullWidth:!0})}}),Object(X.jsx)(l.Controller,{name:"totalCost",control:G,render:function(e){var t=e.field;return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},t),{},{value:t.value.toLocaleString(),disabled:!0,className:"mt-8 mb-16",label:a("TOTAL_COST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(N.a,{position:"start",children:O.cashUnitName})},variant:"outlined",fullWidth:!0}))}}),Object(X.jsx)(l.Controller,{name:"rest",control:G,render:function(e){var t=e.field;return Object(X.jsx)(C.a,{value:t.value.toLocaleString(),inputMode:"numeric",disabled:!0,onChange:function(e){},className:"mt-8 mb-16",label:a("REST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(X.jsx)(N.a,{position:"start",children:O.cashUnitName})},variant:"outlined",fullWidth:!0})}})]}),de&&Object(X.jsxs)("div",{className:"flex w-full",children:[Object(X.jsx)(g.a,{className:"mt-8 mb-16 flex-1",disablePortal:!0,disabled:R===L.a.REVIEW_MODE,options:Object(r.a)(s),value:B,onChange:function(e,t){W(t)},getOptionDisabled:function(e){return e.inventoryNumber<=0},getOptionLabel:function(e){return"".concat(e.name," (").concat(e.inventoryNumber,")")},renderOption:function(e,t){return Object(X.jsxs)(I.a,Object(n.a)(Object(n.a)({component:"li",sx:{"& > img":{mr:2,flexShrink:0}}},e),{},{children:[Object(X.jsx)("img",{loading:"lazy",width:"20",src:t.thumbnail,srcSet:t.thumbnail,alt:""}),"".concat(t.name," (").concat(t.inventoryNumber,")")]}))},loading:q,renderInput:function(e){return Object(X.jsx)(C.a,Object(n.a)(Object(n.a)({},e),{},{placeholder:a("SELECT_PRODUCT_PLACE_HOLDER"),label:a("PRODUCT_LABEL"),variant:"outlined",InputLabelProps:{shrink:!0},InputProps:Object(n.a)(Object(n.a)({},e.InputProps),{},{endAdornment:Object(X.jsxs)(X.Fragment,{children:[q?Object(X.jsx)(E.a,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}),R!==L.a.REVIEW_MODE&&Object(X.jsx)(S.a,{className:"whitespace-nowrap mx-8 mt-8 mb-16",variant:"contained",color:"primary",onClick:function(){var e;B&&(console.log("select",B),m.a.find(se,(function(e){return e.productId===B.id}))||(console.log("selected product",B),ie({productId:B.id,inventoryNumber:B.inventoryNumber,description:"",quantity:0,originalPrice:null!==(e=B.originalPrice)&&void 0!==e?e:0,price:de.isFamiliar&&B.priceForFamiliarCustomer?B.priceForFamiliarCustomer:B.priceForCustomer,productName:"".concat(B.name," | ").concat(b(B.unitName.toUpperCase())),totalCost:0}),W(null)))},startIcon:Object(X.jsx)(P.a,{className:"hidden sm:flex",children:"add"}),children:a("ADD_BUTTON")})]}),se.map((function(e,t){return Object(X.jsx)(te,{index:t,handleRemoveRow:ue},t)}))]})})}))}))}}]);