(this["webpackJsonpfuse-react-app"]=this["webpackJsonpfuse-react-app"]||[]).push([[127],{1390:function(e,t,a){"use strict";a.d(t,"a",(function(){return L}));var n=a(99),r=a(4),c=a(54),o=a(14),i=a(6),s=a(1),l=a(1294),d=a(51),u=a(1377),b=a(41),j=a(15),m=a(0);var h=function(e){var t=Object(d.a)(),a=Object(j.useSelector)(Object(b.c)(t.palette.primary.main));return Object(m.jsx)("div",{className:"FusePageCarded-header",children:e.header&&Object(m.jsx)(u.a,{theme:a,children:e.header})})},O=a(8),p=a(17),f=a(133),x=a(1374),v=a(1378);var g=function(e){var t=Object(d.a)(),a=Object(j.useSelector)(Object(b.c)(t.palette.primary.main));return Object(m.jsxs)(m.Fragment,{children:[e.header&&Object(m.jsx)(u.a,{theme:a,children:Object(m.jsx)("div",{className:Object(i.default)("FusePageCarded-sidebarHeader",e.variant),children:e.header})}),e.content&&Object(m.jsx)(c.default,{className:"FusePageCarded-sidebarContent",enable:e.innerScroll,children:e.content})]})};function C(e,t){var a=Object(s.useState)(!1),n=Object(p.a)(a,2),r=n[0],c=n[1];Object(s.useImperativeHandle)(t,(function(){return{toggleSidebar:o}}));var o=function(){c(!r)};return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(x.a,{lgUp:"permanent"===e.variant,children:Object(m.jsx)(v.a,{variant:"temporary",anchor:e.position,open:r,onOpen:function(e){},onClose:function(e){return o()},disableSwipeToOpen:!0,classes:{root:Object(i.default)("FusePageCarded-sidebarWrapper",e.variant),paper:Object(i.default)("FusePageCarded-sidebar",e.variant,"left"===e.position?"FusePageCarded-leftSidebar":"FusePageCarded-rightSidebar")},ModalProps:{keepMounted:!0},container:e.rootRef.current,BackdropProps:{classes:{root:"FusePageCarded-backdrop"}},style:{position:"absolute"},children:Object(m.jsx)(g,Object(O.a)({},e))})}),"permanent"===e.variant&&Object(m.jsx)(x.a,{lgDown:!0,children:Object(m.jsx)(f.a,{variant:"permanent",className:Object(i.default)("FusePageCarded-sidebarWrapper",e.variant),open:r,classes:{paper:Object(i.default)("FusePageCarded-sidebar",e.variant,"left"===e.position?"FusePageCarded-leftSidebar":"FusePageCarded-rightSidebar")},children:Object(m.jsx)(g,Object(O.a)({},e))})})]})}var E,S=Object(s.forwardRef)(C),N=Object(o.a)("div")((function(e){var t=e.theme;return{display:"flex",flexDirection:"row",minWidth:0,minHeight:"100%",position:"relative",flex:"1 1 auto",width:"100%",height:"auto",backgroundColor:t.palette.background.default,"& .FusePageCarded-innerScroll":{height:"100%"},"& .FusePageCarded-topBg":{position:"absolute",left:0,right:0,top:0,height:I,background:"linear-gradient(to right, ".concat(t.palette.primary.dark," 0%, ").concat(t.palette.primary.main," 100%)"),backgroundSize:"cover",pointerEvents:"none"},"& .FusePageCarded-contentWrapper":Object(r.a)({display:"flex",flexDirection:"column",padding:"0 3.2rem",flex:"1 1 100%",zIndex:2,maxWidth:"100%",minWidth:0,minHeight:0},t.breakpoints.down("sm"),{padding:"0 1.6rem"}),"& .FusePageCarded-header":{height:_,minHeight:_,maxHeight:_,display:"flex",color:t.palette.primary.contrastText},"& .FusePageCarded-headerSidebarToggleButton":{color:t.palette.primary.contrastText},"& .FusePageCarded-contentCard":{display:"flex",flex:"1 1 100%",flexDirection:"column",backgroundColor:t.palette.background.paper,boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",minHeight:0,borderRadius:"20px 20px 0 0"},"& .FusePageCarded-toolbar":{height:w,minHeight:w,display:"flex",alignItems:"center",borderBottom:"1px solid ".concat(t.palette.divider)},"& .FusePageCarded-content":{flex:"1 1 auto",height:"100%",overflow:"auto",WebkitOverflowScrolling:"touch"},"& .FusePageCarded-sidebarWrapper":{position:"absolute",backgroundColor:"transparent",zIndex:5,overflow:"hidden","&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{zIndex:1,position:"relative"})},"& .FusePageCarded-sidebar":{position:"absolute","&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{backgroundColor:"transparent",position:"relative",border:"none",overflow:"hidden"}),width:P,height:"100%"},"& .FusePageCarded-leftSidebar":{},"& .FusePageCarded-rightSidebar":{},"& .FusePageCarded-sidebarHeader":{height:I,minHeight:I,color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.dark,"&.permanent":Object(r.a)({},t.breakpoints.up("lg"),{backgroundColor:"transparent"})},"& .FusePageCarded-sidebarContent":Object(r.a)({display:"flex",flex:"1 1 auto",flexDirection:"column",backgroundColor:t.palette.background.default,color:t.palette.text.primary},t.breakpoints.up("lg"),{overflow:"auto",WebkitOverflowScrolling:"touch"}),"& .FusePageCarded-backdrop":{position:"absolute"}}})),P=240,I=200,w=64,_=I-w,T=Object(s.forwardRef)((function(e,t){var a=Object(s.useRef)(null),n=Object(s.useRef)(null),r=Object(s.useRef)(null),o=e.rightSidebarHeader||e.rightSidebarContent,d=e.leftSidebarHeader||e.leftSidebarContent;return Object(s.useImperativeHandle)(t,(function(){return{rootRef:r,toggleLeftSidebar:function(){a.current.toggleSidebar()},toggleRightSidebar:function(){n.current.toggleSidebar()}}})),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(l.a,{styles:function(t){return{"#fuse-main":{height:e.innerScroll&&"100vh"}}}}),Object(m.jsxs)(N,{className:Object(i.default)("FusePageCarded-root",e.innerScroll&&"FusePageCarded-innerScroll",e.className),ref:r,children:[Object(m.jsx)("div",{className:"FusePageCarded-topBg"}),Object(m.jsxs)("div",{className:"flex container w-full",children:[d&&Object(m.jsx)(S,{position:"left",header:e.leftSidebarHeader,content:e.leftSidebarContent,variant:e.leftSidebarVariant||"permanent",innerScroll:e.innerScroll,ref:a,rootRef:r}),Object(m.jsxs)("div",{className:Object(i.default)("FusePageCarded-contentWrapper",d&&(void 0===e.leftSidebarVariant||"permanent"===e.leftSidebarVariant)&&"lg:ltr:pl-0 lg:rtl:pr-0",o&&(void 0===e.rightSidebarVariant||"permanent"===e.rightSidebarVariant)&&"lg:pr-0"),children:[Object(m.jsx)(h,{header:e.header}),Object(m.jsxs)("div",{className:Object(i.default)("FusePageCarded-contentCard",e.innerScroll&&"inner-scroll"),children:[e.contentToolbar&&Object(m.jsx)("div",{className:"FusePageCarded-toolbar",children:e.contentToolbar}),e.content&&Object(m.jsx)(c.default,{className:"FusePageCarded-content",enable:e.innerScroll,scrollToTopOnRouteChange:e.innerScroll,children:e.content})]})]}),o&&Object(m.jsx)(S,{position:"right",header:e.rightSidebarHeader,content:e.rightSidebarContent,variant:e.rightSidebarVariant||"permanent",innerScroll:e.innerScroll,ref:n,rootRef:r})]})]})]})}));T.defaultProps={};var L=Object(s.memo)(Object(o.a)(T)(E||(E=Object(n.a)([""]))))},1645:function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"f",(function(){return l})),a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return u})),a.d(t,"e",(function(){return b})),a.d(t,"g",(function(){return j})),a.d(t,"i",(function(){return p})),a.d(t,"h",(function(){return f}));var n=a(55),r=a(1646),c=a(37),o=c.createSlice,i=c.createAsyncThunk,s=i("invoices/createUpdateInvoice/getCustomers",(function(e,t){var a=t.dispatch;return new Promise((function(e,t){n.a.get(n.c.getCustomers).then((function(t){var n=t.data.data;a(O(n)),e()}))}))})),l=i("invoices/createUpdateInvoice/getProducts",(function(e,t){var a=t.dispatch;return new Promise((function(e,t){n.a.get(n.c.getProducts).then((function(t){var r=t.data.data.map((function(e){return new Promise((function(t){n.a.get(n.c.getProductThumbnailById(e.id),{responseType:"blob"}).then((function(a){var n=a.data,r=URL.createObjectURL(n);e.thumbnail=r,t(e)})).catch((function(a){e.thumbnail=null,t(e)}))}))}));Promise.all(r).then((function(t){a(x(t)),e()}))}))}))})),d=i("invoices/createUpdateInvoice/createCustomer",(function(e,t){t.dispatch;return e.phone&&""!==e.phone&&(e.phone="+84".concat(e.phone)),new Promise((function(t,a){n.a.post(n.c.createCustomer,e).then((function(e){t()}))}))})),u=i("invoices/createUpdateInvoice/createInvoice",(function(e,t){t.dispatch,t.getState;return new Promise((function(t,a){n.a.post(n.c.createInvoice,e).then((function(e){t(e.data.data)})).catch((function(e){a()}))}))})),b=i("invoices/createUpdateInvoice/getInvoiceById",(function(e,t){var a=t.dispatch;t.getState;return new Promise((function(t,r){n.a.get(n.c.getInvoiceById(e)).then((function(e){var n=e.data.data,r={id:n.id,customer:{id:n.customerId,name:n.customerName,phone:n.customerPhone,address:n.customerAddress,phonePrefix:n.customerPhonePrefix},code:"",date:n.createdDate,customerDebt:n.debt,totalCost:n.totalCost,deposit:n.deposit,rest:n.rest,details:n.details.map((function(e){return{productId:e.productId,description:e.description,quantity:e.quantity,originalPrice:e.originalPrice,price:e.price,productName:"".concat(e.productName," | ").concat(e.unitName),totalCost:e.totalCost}}))};a(v(r)),t()}))}))})),j=i("invoices/createUpdateInvoice/restoreInvoiceById",(function(e,t){var a=t.dispatch;t.getState;return new Promise((function(t,c){n.a.post(n.c.restoreInvoiceById(e)).then((function(e){a(f(r.a.NEW_MODE)),t()}))}))})),m=o({initialState:{customers:[],invoice:{},mode:r.a.NEW_MODE,products:[]},name:"createUpdateInvoice",reducers:{resetState:function(e,t){},setCustomers:function(e,t){e.customers=t.payload},setProducts:function(e,t){e.products=t.payload},setInvoice:function(e,t){e.invoice=t.payload},setNewInvoice:function(e,t){e.invoice={customer:null,code:"",date:new Date,customerDebt:0,totalCost:0,deposit:0,rest:0,details:[]}},setMode:function(e,t){e.mode=t.payload}}}),h=m.actions,O=(h.resetState,h.setCustomers),p=h.setNewInvoice,f=h.setMode,x=h.setProducts,v=h.setInvoice;t.c=m.reducer},1646:function(e,t,a){"use strict";t.a={THUMBNAIL_ASSET_TYPE:"thumbnail",SLIDE_ASSET_TYPE:"slide",NEW_MODE:"new",UPDATE_MODE:"update",REVIEW_MODE:"review"}},1695:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return d})),a.d(t,"e",(function(){return u})),a.d(t,"f",(function(){return b}));var n=a(55),r=a(37),c=r.createSlice,o=(0,r.createAsyncThunk)("invoices/invoices/getInvoices",(function(e,t){var a=t.dispatch,r=t.getState;return new Promise((function(e,t){var c=r().invoices.invoices.page,o=r().invoices.invoices.rowsPerPage,i=r().invoices.invoices,s=i.searchText,l=i.order;n.a.get(n.c.getInvoices,{params:{pageIndex:c,pageSize:o,search:s,sortFieldName:l.id,isSortAscending:"asc"===l.direction}}).then((function(t){a(m(t.data.data)),a(j(t.data.totalItems)),e()}))}))})),i=c({initialState:{searchText:"",data:[],order:{id:"code",direction:"asc"},totalRecords:0,rowsPerPage:5,page:0},name:"invoices",reducers:{resetState:function(e,t){},setTotalRecords:function(e,t){e.totalRecords=t.payload},setData:function(e,t){e.data=t.payload},setInvoiceSearchText:function(e,t){e.searchText=t.payload},setOrder:function(e,t){e.order=t.payload},setPage:function(e,t){e.page=t.payload},setRowsPerPage:function(e,t){e.rowsPerPage=t.payload}}}),s=i.actions,l=(s.resetState,s.setInvoiceSearchText),d=s.setOrder,u=s.setPage,b=s.setRowsPerPage,j=s.setTotalRecords,m=s.setData;t.a=i.reducer},1739:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n=a(8),r=a(17),c=a(1335),o=a(767),i=a(776),s=a(1331),l=a(1347),d=a(1),u=a(47),b=a(1375),j=a(15),m=a(1336),h=a(1467),O=a(1466),p=a(1498),f=a(324),x=a(76),v=a(188),g=a(1333),C=a(1334),E=a(55),S=a(332),N=a.n(S),P=a(322),I=a(0),w=x.e().shape({name:x.g().required(),phone:x.g().length(9),address:x.g(),isFamiliar:x.b()}),_=function(e){var t=e.customer,a=Object(j.useDispatch)(),x=Object(u.useForm)({mode:"onChange",defaultValues:{},resolver:Object(v.a)(w)}),S=Object(d.useState)([]),_=Object(r.a)(S,2),T=_[0],L=_[1],y=Object(b.a)("invoices").t,A=x.control,D=x.formState,F=(x.setValue,x.reset),U=x.watch,R=x.getValues,B=D.errors;Object(d.useEffect)((function(){Object(E.b)().then((function(e){L(e)}))}),[L,F]),Object(d.useEffect)((function(){if(T.length>0)if(t){var e,a=Object(n.a)({},t);a.phoneCountryId=null!==(e=a.phoneCountryId)&&void 0!==e?e:T[0].id,F(a)}else F({id:0,name:"",phone:"",address:"",isFamiliar:!1,phoneCountryId:T[0].id})}),[t,T,F]);var k=U();return N.a.isEmpty(k)?Object(I.jsx)(I.Fragment,{children:Object(I.jsx)(O.a,{children:Object(I.jsx)(P.a,{})})}):Object(I.jsxs)(u.FormProvider,Object(n.a)(Object(n.a)({},x),{},{children:[Object(I.jsx)(p.a,{id:"alert-dialog-title",children:y("CREATE_CUSTOMER_TITLE",{name:k.name})}),Object(I.jsxs)(O.a,{children:[Object(I.jsx)(u.Controller,{name:"name",control:A,render:function(e){var t=e.field;return Object(I.jsx)(c.a,Object(n.a)(Object(n.a)({},t),{},{className:"mt-8 mb-16",error:!!B.name,required:!0,label:y("CUSTOMER_NAME_LABEL"),autoFocus:!0,id:"name",variant:"outlined",fullWidth:!0}))}}),Object(I.jsxs)("div",{className:"flex w-full mt-8 mb-16",children:[Object(I.jsx)(u.Controller,{name:"phoneCountryId",control:A,render:function(e){var t=e.field;return Object(I.jsx)(o.a,{className:"w-1/5",children:Object(I.jsx)(i.a,{id:"phone-country-select",value:t.value,onChange:function(e){t.onChange(e.target.value)},children:T.map((function(e,t){return Object(I.jsx)(s.a,{value:e.id,children:Object(I.jsx)("img",{className:"max-w-none w-auto h-20",src:e.logoUrl,alt:"product"})},e.id)}))})})}}),Object(I.jsx)(u.Controller,{name:"phone",control:A,render:function(e){var t=e.field;return Object(I.jsx)(c.a,Object(n.a)(Object(n.a)({},t),{},{className:"ml-8 flex-1",error:!!B.phone,required:!0,label:y("CUSTOMER_PHONE_LABEL"),id:"phone",variant:"outlined",fullWidth:!0,InputProps:{startAdornment:Object(I.jsx)(l.a,{position:"start",children:N.a.find(T,(function(e){return e.id===k.phoneCountryId})).phonePrefix})}}))}})]}),Object(I.jsx)(u.Controller,{name:"address",control:A,render:function(e){var t=e.field;return Object(I.jsx)(c.a,Object(n.a)(Object(n.a)({},t),{},{className:"mt-8 mb-16",error:!!B.address,required:!0,label:y("CUSTOMER_ADDRESS_LABEL"),id:"address",variant:"outlined",fullWidth:!0}))}}),Object(I.jsx)(u.Controller,{name:"isFamiliar",control:A,render:function(e){var t=e.field,a=t.onChange,n=t.value;return Object(I.jsx)(g.a,{className:"mt-8 mb-16",label:y("CUSTOMER_IS_FAMILIAR_LABEL"),control:Object(I.jsx)(C.a,{onChange:function(e){a(e.target.checked)},checked:n,name:"hasAutoCalculatePermission"})})}})]}),Object(I.jsxs)(h.a,{children:[Object(I.jsx)(m.a,{onClick:function(){return a(Object(f.a)())},color:"error",children:y("CANCEL_BUTTON")}),Object(I.jsx)(m.a,{onClick:function(){var t=R();console.log("create customer data",t),0===t.id?e.createCustomer(t):e.updateCustomer(t)},color:"secondary",children:y("SAVE_BUTTON")})]})]}))}},1760:function(e,t,a){"use strict";var n=a(224),r=a(1),c=a(15).useDispatch;t.a=function(){var e=c();return{showNotification:Object(r.useCallback)((function(t){console.log("show notification",t),e(Object(n.b)(t))}),[e])}}},1763:function(e,t,a){"use strict";var n=a(160),r=a(1695),c=a(1645);t.a=Object(n.d)({invoices:r.a,createUpdateInvoice:c.c})},3405:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a(17),c=a(4),o=a(14),i=a(1390),s=a(47),l=a(188),d=a(1),u=a(66),b=a(332),j=a.n(b),m=a(190),h=a(128),O=a(76),p=a(322),f=a(1351),x=a(1350),v=a(1375),g=a(15),C=a(1763),E=a(20),S=a(1663),N=a(1335),P=a(1513),I=a(1347),w=a(324),_=a(1645),T=a(1646),L=a(1739),y=a(0),A=function(){var e=Object(d.useState)(!0),t=Object(r.a)(e,2),a=t[0],c=t[1],o=Object(s.useFormContext)(),i=o.control,l=o.setValue,u=o.getValues,b=Object(g.useDispatch)(),j=Object(g.useSelector)((function(e){return e.invoices.createUpdateInvoice.customers})),m=Object(g.useSelector)((function(e){return e.auth.user.shop}));Object(d.useEffect)((function(){b(Object(_.d)()).then((function(){c(!1)}))}),[b]);var h=Object(v.a)("invoices").t,O=Object(g.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode}));return Object(y.jsxs)("div",{children:[Object(y.jsx)(s.Controller,{name:"customer",control:i,defaultValue:[],render:function(e){var t=e.field,r=t.onChange,o=t.value;return Object(y.jsx)(S.a,{loading:a,disabled:O===T.a.REVIEW_MODE,className:"mt-8 mb-16",disablePortal:!0,getOptionLabel:function(e){var t=e.name;return e.phone?t+=" | ".concat(e.phonePrefix).concat(e.phone):e.address&&(t+=" | ".concat(e.address)),t},filterOptions:function(e,t){var a=[],n=t.inputValue;return e.forEach((function(e){var n,r,c;"".concat(null!==(n=e.name)&&void 0!==n?n:"").concat(null!==(r=e.phone)&&void 0!==r?r:"").concat(null!==(c=e.address)&&void 0!==c?c:"").toLowerCase().includes(t.inputValue.toLowerCase())&&a.push(e)})),""!==n&&0===a.length&&a.push({id:0,inputValue:n,name:"".concat(h("ADD_BUTTON"),' "').concat(n,'"')}),a},isOptionEqualToValue:function(e,t){return e.id===t.id},options:Object(E.a)(j),value:o,onChange:function(e,t){console.log("new customer",t),0===t.id?b(Object(w.c)({children:Object(y.jsx)(L.a,{customer:{id:0,address:"",name:t.inputValue,phone:"",isFamiliar:!1},createCustomer:function(e){b(Object(_.a)(e)).then((function(){b(Object(w.a)()),c(!0),b(Object(_.d)()).then((function(){c(!1)}))}))}})})):(l("customerDebt",t.debt),r(t))},renderInput:function(e){return Object(y.jsx)(N.a,Object(n.a)(Object(n.a)({},e),{},{placeholder:h("SELECT_CUSTOMER_PLACE_HOLDER"),label:h("CUSTOMER_LABEL"),variant:"outlined",InputLabelProps:{shrink:!0},InputProps:Object(n.a)(Object(n.a)({},e.InputProps),{},{endAdornment:Object(y.jsxs)(y.Fragment,{children:[a?Object(y.jsx)(P.a,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}})}}),Object(y.jsx)(s.Controller,{name:"customerDebt",control:i,render:function(e){var t=e.field;return Object(y.jsx)(N.a,Object(n.a)(Object(n.a)({disabled:!0},t),{},{value:t.value.toLocaleString(),className:"mt-8 mb-16",label:h("DEBT_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(y.jsx)(I.a,{position:"start",children:m.cashUnitName})},variant:"outlined",fullWidth:!0}))}}),Object(y.jsx)(s.Controller,{name:"totalCost",control:i,render:function(e){var t=e.field;return Object(y.jsx)(N.a,Object(n.a)(Object(n.a)({},t),{},{value:t.value.toLocaleString(),disabled:!0,className:"mt-8 mb-16",label:h("TOTAL_COST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(y.jsx)(I.a,{position:"start",children:m.cashUnitName})},variant:"outlined",fullWidth:!0}))}}),Object(y.jsx)(s.Controller,{name:"deposit",control:i,render:function(e){var t=e.field;return Object(y.jsx)(N.a,{value:t.value.toLocaleString(),inputMode:"numeric",disabled:O===T.a.REVIEW_MODE,onChange:function(e){var a=e.target.value;a=a.replaceAll(",","");var n=parseFloat(a);n||(n=0),t.onChange(n);var r=u("totalCost"),c=u("customerDebt");l("rest",r+c-n)},className:"mt-8 mb-16",label:h("DEPOSIT_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(y.jsx)(I.a,{position:"start",children:m.cashUnitName})},variant:"outlined",fullWidth:!0})}}),Object(y.jsx)(s.Controller,{name:"rest",control:i,render:function(e){var t=e.field;return Object(y.jsx)(N.a,{value:t.value.toLocaleString(),inputMode:"numeric",disabled:!0,onChange:function(e){},className:"mt-8 mb-16",label:h("REST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(y.jsx)(I.a,{position:"start",children:m.cashUnitName})},variant:"outlined",fullWidth:!0})}})]})},D=a(21),F=a(194),U=a(1336),R=a(1327),B=a(222),k=a(1389),M=function(e){var t=e.index,a=Object(s.useFormContext)(),r=a.control,c=(a.watch,a.getValues),o=a.setValue,i=Object(v.a)("invoices").t,l=Object(g.useSelector)((function(e){return e.auth.user.shop})),d=Object(g.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),u=Object(h.a)((function(e){F.a.convertUnitValue(l.cashUnitId,e).then((function(e){o("details.".concat(t,".totalCost"),e);var a=c("details"),n=0;a.forEach((function(e){n+=e.totalCost})),o("totalCost",n);var r=c("deposit"),i=c("customerDebt");o("rest",n+i-r)}))}),500),b=c("details.".concat(t,".inventoryNumber"));return Object(y.jsxs)("div",{className:"flex w-full",children:[Object(y.jsxs)("div",{className:"flex flex-col w-1/4",children:[Object(y.jsx)(s.Controller,{control:r,name:"details.".concat(t,".productName"),render:function(e){var t=e.field;return Object(y.jsx)(N.a,Object(n.a)(Object(n.a)({disabled:!0},t),{},{className:"mt-8 mb-16 w-full",label:i("PRODUCT_NAME_LABEL"),id:"productName",variant:"outlined",autoFocus:!0}))}}),Object(y.jsx)(s.Controller,{name:"details.".concat(t,".quantity"),control:r,render:function(e){var a=e.field;return Object(y.jsx)(N.a,{value:a.value.toLocaleString(),disabled:d===T.a.REVIEW_MODE,onChange:function(e){var n=e.target.value;n=n.replaceAll(",","");var r=parseFloat(n);r||(r=0),r>b&&(r=0),a.onChange(r);var o=c("details.".concat(t,".price")),i=parseFloat(o)*r;i&&u(i)},className:"mt-8 mb-16  w-full",label:i("QUANTITY_LABEL"),id:"pricePerMass",InputProps:{endAdornment:d===T.a.NEW_MODE?Object(y.jsx)(I.a,{position:"end",children:"< ".concat(b)}):void 0},type:"number",variant:"outlined"})}})]}),Object(y.jsxs)("div",{className:"flex flex-col w-1/4 mx-4",children:[Object(y.jsx)(s.Controller,{name:"details.".concat(t,".price"),control:r,render:function(e){var a=e.field;return Object(y.jsx)(N.a,Object(n.a)(Object(n.a)({},a),{},{value:a.value.toLocaleString(),inputMode:"numeric",disabled:d===T.a.REVIEW_MODE,onChange:function(e){var n=e.target.value;n=n.replaceAll(",","");var r=parseFloat(n);r||(r=0),a.onChange(r);var o=c("details.".concat(t,".quantity")),i=r*parseFloat(o);i&&u(i)},className:"mt-8 mb-16 w-full",label:i("PRICE_LABEL"),id:"pricePerMass",InputProps:{lang:"en-US",startAdornment:Object(y.jsx)(I.a,{position:"start",children:l.cashUnitName})},variant:"outlined"}))}}),Object(y.jsx)(s.Controller,{name:"details.".concat(t,".totalCost"),control:r,render:function(e){var t=e.field;return Object(y.jsx)(N.a,Object(n.a)(Object(n.a)({},t),{},{value:t.value.toLocaleString(),inputMode:"numeric",disabled:!0,className:"mt-8 mb-16 w-full",label:i("TOTAL_COST_LABEL"),id:"pricePerMass",InputProps:{startAdornment:Object(y.jsx)(I.a,{position:"start",children:l.cashUnitName})},variant:"outlined"}))}})]}),Object(y.jsx)(s.Controller,{name:"details.".concat(t,".description"),control:r,render:function(e){var t=e.field;return Object(y.jsx)(N.a,Object(n.a)(Object(n.a)({},t),{},{disabled:d===T.a.REVIEW_MODE,className:"mt-8 mb-16 mx-4 flex-1",id:"description",label:i("DESCRIPTION_LABEL"),type:"text",multiline:!0,rows:5,variant:"outlined",fullWidth:!0}))}}),d!==T.a.REVIEW_MODE&&Object(y.jsx)("div",{className:"flex flex-col w-1/9 mx-4 items-center justify-center",children:Object(y.jsx)(U.a,{className:"whitespace-nowrap mx-8 mt-8 mb-16",variant:"contained",color:"error",onClick:function(){e.handleRemoveRow(t)},startIcon:Object(y.jsx)(R.a,{className:"hidden sm:flex",children:"delete"}),children:i("REMOVE_BUTTON")})})]})},V=function(){var e=Object(s.useFormContext)(),t=e.control,a=e.watch,c=Object(d.useState)(null),o=Object(r.a)(c,2),i=o[0],l=o[1],u=Object(d.useState)(!0),b=Object(r.a)(u,2),j=b[0],m=b[1],h=Object(s.useFieldArray)({control:t,name:"details"}),O=h.append,p=h.remove,f=h.fields,x=Object(v.a)("invoices").t,C=Object(v.a)("units").t,I=Object(g.useSelector)((function(e){return e.invoices.createUpdateInvoice.products})),w=Object(g.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),L=Object(g.useDispatch)();Object(d.useEffect)((function(){L(Object(_.f)()).then((function(){m(!1)}))}),[L]);var A=function(e){p(e)},F=a("customer");return F?(console.log("unit translation",C),Object(y.jsxs)("div",{children:[Object(y.jsxs)("div",{className:"flex w-full",children:[Object(y.jsx)(S.a,{className:"mt-8 mb-16 flex-1",disablePortal:!0,disabled:w===T.a.REVIEW_MODE,options:Object(E.a)(I),value:i,onChange:function(e,t){l(t)},getOptionDisabled:function(e){return e.inventoryNumber<=0},getOptionLabel:function(e){return"".concat(e.name," (").concat(e.inventoryNumber,")")},renderOption:function(e,t){return Object(y.jsxs)(k.a,Object(n.a)(Object(n.a)({component:"li",sx:{"& > img":{mr:2,flexShrink:0}}},e),{},{children:[Object(y.jsx)("img",{loading:"lazy",width:"20",src:t.thumbnail,srcSet:t.thumbnail,alt:""}),"".concat(t.name," (").concat(t.inventoryNumber,")")]}))},loading:j,renderInput:function(e){return Object(y.jsx)(N.a,Object(n.a)(Object(n.a)({},e),{},{placeholder:x("SELECT_PRODUCT_PLACE_HOLDER"),label:x("PRODUCT_LABEL"),variant:"outlined",InputLabelProps:{shrink:!0},InputProps:Object(n.a)(Object(n.a)({},e.InputProps),{},{endAdornment:Object(y.jsxs)(y.Fragment,{children:[j?Object(y.jsx)(P.a,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}),w!==T.a.REVIEW_MODE&&Object(y.jsx)(U.a,{className:"whitespace-nowrap mx-8 mt-8 mb-16",variant:"contained",color:"primary",onClick:function(){var e;i&&(console.log("select",i),D.a.find(f,(function(e){return e.productId===i.id}))||(console.log("selected product",i),O({productId:i.id,inventoryNumber:i.inventoryNumber,description:"",quantity:0,originalPrice:null!==(e=i.originalPrice)&&void 0!==e?e:0,price:F.isFamiliar&&i.priceForFamiliarCustomer?i.priceForFamiliarCustomer:i.priceForCustomer,productName:"".concat(i.name," | ").concat(C(i.unitName.toUpperCase())),totalCost:0})))},startIcon:Object(y.jsx)(R.a,{className:"hidden sm:flex",children:"add"}),children:x("ADD_BUTTON")})]}),f.map((function(e,t){return Object(y.jsx)(M,{index:t,handleRemoveRow:A},t)}))]})):Object(y.jsx)(B.a,{className:"text-13 sm:text-20 mb-16",color:"textSecondary",children:x("GO_BACK_BASIC_MSG")})},W=a(51),H=a(1372),q=a(43),z=a(1885),Y=a(1760),G=a(541),J=function(){var e=Object(d.useState)(!1),t=Object(r.a)(e,2),a=t[0],n=t[1],c=Object(d.useState)(!1),o=Object(r.a)(c,2),i=o[0],l=o[1],b=Object(g.useDispatch)(),j=Object(s.useFormContext)(),m=j.formState,h=j.watch,O=j.getValues,p=(j.handleSubmit,m.isValid),f=(m.dirtyFields,m.errors,Object(v.a)("invoices").t),x=h("customer"),C=Object(W.a)(),E=Object(u.h)(),S=Object(g.useSelector)((function(e){return e.invoices.createUpdateInvoice.mode})),N=Object(Y.a)().showNotification,P=Object(g.useSelector)((function(e){return e.i18n.language})),I=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=O();n(!0);var a={customerId:t.customer.id,deposit:t.deposit,details:t.details.map((function(e){return{productId:e.productId,quantity:e.quantity,price:e.price,description:e.description,originalPrice:e.originalPrice}}))};console.log("validated data",a),b(Object(_.b)(a)).then((function(t){if(n(!1),e){var a=t.payload.id;Object(G.d)(a,P).then((function(e){console.log("download file",e),F.a.downloadUrl(e),N({translation:"CREATE_SUCCESSFULLY",options:{variant:"success"}}),E.push("/apps/invoices")}))}else N({translation:"CREATE_SUCCESSFULLY",options:{variant:"success"}}),E.push("/apps/invoices")})).catch((function(e){n(!1)}))};return Object(y.jsxs)("div",{className:"flex flex-1 w-full items-center justify-between",children:[Object(y.jsxs)("div",{className:"flex flex-col items-start max-w-full min-w-0",children:[Object(y.jsx)(H.a.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1,transition:{delay:.3}},children:Object(y.jsxs)(B.a,{className:"flex items-center sm:mb-12",component:q.a,role:"button",to:"/apps/invoices",color:"inherit",children:[Object(y.jsx)(R.a,{className:"text-20",children:"ltr"===C.direction?"arrow_back":"arrow_forward"}),Object(y.jsx)("span",{className:"hidden sm:flex mx-4 font-medium",children:f("MANAGE_INVOICES_LABEL")})]})}),Object(y.jsx)("div",{className:"flex items-center max-w-full",children:Object(y.jsx)("div",{className:"flex flex-col min-w-0 mx-8 sm:mc-16",children:Object(y.jsxs)(H.a.div,{initial:{x:-20},animate:{x:0,transition:{delay:.3}},children:[Object(y.jsx)(B.a,{className:"text-16 sm:text-20 truncate font-semibold",children:x?x.name:f("NEW_INVOICE_LABEL")}),Object(y.jsx)(B.a,{variant:"caption",className:"font-medium",children:f("INVOICE_DETAIL")})]})})})]}),Object(y.jsxs)(H.a.div,{className:"flex",initial:{opacity:0,x:20},animate:{opacity:1,x:0,transition:{delay:.3}},children:[S===T.a.REVIEW_MODE&&Object(y.jsx)(z.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:i,color:"warning",onClick:function(){var e=O();l(!0),b(Object(_.g)(e.id)).then((function(){l(!1)}))},startIcon:Object(y.jsx)(R.a,{className:"hidden sm:flex",children:"restore"}),children:f("RESTORE_BUTTON")}),S===T.a.REVIEW_MODE&&Object(y.jsx)(U.a,{className:"whitespace-nowrap mx-4",variant:"contained",color:"secondary",onClick:function(){var e=O();Object(G.d)(e.id,P).then((function(e){F.a.downloadUrl(e)}))},startIcon:Object(y.jsx)(R.a,{className:"hidden sm:flex",children:"download"}),children:f("DOWNLOAD_BUTTON")}),(S===T.a.UPDATE_MODE||S===T.a.NEW_MODE)&&Object(y.jsx)(z.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:a,color:"secondary",disabled:!p,onClick:function(){I(!1)},children:f("SAVE_BUTTON")}),(S===T.a.UPDATE_MODE||S===T.a.NEW_MODE)&&Object(y.jsx)(z.a,{className:"whitespace-nowrap mx-4",variant:"contained",loading:a,color:"secondary",disabled:!p,onClick:function(){I(!0)},children:f("SAVE_DOWNLOAD_BUTTON")})]})]})},K=a(1346),Q=a(1348),X=a(1520),Z=a(1524),$=a(1523),ee=a(1521),te=a(1522),ae=Object(o.a)("div")((function(e){var t=e.theme;return{"& table ":{"& th:first-child, & td:first-child":{paddingLeft:"".concat(0,"!important")},"& th:last-child, & td:last-child":{paddingRight:"".concat(0,"!important")}},"& .divider":{width:1,backgroundColor:t.palette.divider,height:144},"& .seller":{backgroundColor:t.palette.primary.dark,color:t.palette.getContrastText(t.palette.primary.dark),marginRight:-88,paddingRight:66,width:480,"& .divider":{backgroundColor:t.palette.getContrastText(t.palette.primary.dark),opacity:.5}}}})),ne=function(){var e=Object(s.useFormContext)(),t=Object(v.a)("invoices").t,a=e.watch,n=Object(g.useSelector)((function(e){return e.auth.user.shop})),r=a();return r.customer&&0!==r.details.length?Object(y.jsx)(y.Fragment,{children:Object(y.jsx)(ae,{className:"flex-grow flex-shrink-0 p-0",children:Object(y.jsx)(K.a,{className:"w-xl mx-auto shadow-0",children:Object(y.jsxs)(Q.a,{className:"p-20 print:p-0",children:[Object(y.jsxs)("div",{className:"flex justify-between",children:[Object(y.jsxs)("div",{children:[Object(y.jsx)("table",{className:"mb-8",children:Object(y.jsx)("tbody",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{className:"pb-4",children:Object(y.jsx)(B.a,{className:"font-light",variant:"h6",color:"textSecondary",children:t("INVOICE_PDF_HEADER")})}),Object(y.jsx)("td",{className:"pb-4 px-8",children:Object(y.jsx)(B.a,{className:"font-light",variant:"h6",color:"inherit",children:r.code})})]})})}),Object(y.jsx)(B.a,{color:"textSecondary",children:r.customer&&r.customer.name}),Object(y.jsx)(B.a,{color:"textSecondary",children:r.customer&&r.customer.phone}),Object(y.jsx)(B.a,{color:"textSecondary",children:r.customer&&r.customer.address}),Object(y.jsxs)(B.a,{color:"textSecondary",children:[t("TOTAL_COST_LABEL"),": ",r.totalCost.toLocaleString()," ",n.cashUnitName]}),Object(y.jsx)(B.a,{color:"textSecondary",children:r.customerDebt>0&&"".concat(t("DEBT_LABEL"),": ").concat(r.customerDebt.toLocaleString()," ").concat(n.cashUnitName)}),Object(y.jsxs)(B.a,{color:"textSecondary",children:[t("DEPOSIT_LABEL"),": ",r.deposit.toLocaleString()," ",n.cashUnitName]}),Object(y.jsxs)(B.a,{color:"textSecondary",children:[t("REST_LABEL"),": ",r.rest.toLocaleString()," ",n.cashUnitName]})]}),Object(y.jsxs)("div",{className:"seller flex items-center p-16",children:[Object(y.jsx)("img",{className:"w-80",src:n.logoUrl,alt:"logo"}),Object(y.jsx)("div",{className:"divider mx-8 h-96"}),Object(y.jsxs)("div",{className:"px-8",children:[Object(y.jsxs)(B.a,{color:"inherit",children:[n.name,"."]}),Object(y.jsx)(B.a,{color:"inherit",children:n.address}),n.phones&&n.phones.map((function(e,t){return Object(y.jsx)(B.a,{color:"inherit",children:"".concat(e.ownerName," (").concat(e.phonePrefix).concat(e.phone,")")},t)})),n.emails&&n.emails.map((function(e){return Object(y.jsx)(B.a,{color:"inherit",children:e})}))]})]})]}),Object(y.jsx)("div",{className:"mt-6",children:Object(y.jsxs)(X.a,{className:"simple",children:[Object(y.jsx)(ee.a,{children:Object(y.jsxs)(te.a,{children:[Object(y.jsx)($.a,{children:t("PRODUCT_LABEL")}),Object(y.jsx)($.a,{align:"right",children:t("PRICE_LABEL")}),Object(y.jsx)($.a,{align:"right",children:t("QUANTITY_LABEL")}),Object(y.jsx)($.a,{align:"right",children:t("TOTAL_COST_LABEL")})]})}),Object(y.jsx)(Z.a,{children:r.details.map((function(e,t){return Object(y.jsxs)(te.a,{children:[Object(y.jsxs)($.a,{children:[Object(y.jsx)(B.a,{variant:"subtitle1",children:e.productName}),Object(y.jsx)(B.a,{children:e.description})]}),Object(y.jsx)($.a,{align:"right",children:"".concat(e.price.toLocaleString()," ").concat(n.cashUnitName)}),Object(y.jsx)($.a,{align:"right",children:e.quantity}),Object(y.jsx)($.a,{align:"right",children:"".concat(e.totalCost.toLocaleString()," ").concat(n.cashUnitName)})]},t)}))})]})})]})})})}):Object(y.jsx)(B.a,{className:"text-13 sm:text-20 mb-16",color:"textSecondary",children:t("GO_BACK_BASIC_AND_DETAILS_MSG")})},re=Object(o.a)(i.a)((function(e){var t=e.theme;return{"& .FusePageCarded-header":Object(c.a)({minHeight:72,height:72,alignItems:"center"},t.breakpoints.up("sm"),{minHeight:136,height:136})}})),ce=O.e().shape({customer:O.e().required(),details:O.a().min(1)});t.default=Object(m.a)("invoices",C.a)((function(){var e=Object(d.useState)(0),t=Object(r.a)(e,2),a=t[0],c=t[1],o=Object(v.a)("invoices").t,i=Object(g.useSelector)((function(e){return e.invoices.createUpdateInvoice.invoice})),b=Object(u.j)(),m=Object(g.useDispatch)();Object(h.b)((function(){var e=b.invoiceId;"new"===e?(m(Object(_.h)(T.a.NEW_MODE)),m(Object(_.i)())):(m(Object(_.h)(T.a.REVIEW_MODE)),console.log("get invoice",e),m(Object(_.e)(e)))}),[b]);var O=Object(s.useForm)({mode:"onChange",defaultValues:{},resolver:Object(l.a)(ce)}),C=O.watch,E=O.reset;Object(d.useEffect)((function(){E(i)}),[E,i]);var S=C();return j.a.isEmpty(S)?Object(y.jsx)(p.a,{}):Object(y.jsx)(s.FormProvider,Object(n.a)(Object(n.a)({},O),{},{children:Object(y.jsx)(re,{innerScroll:!0,header:Object(y.jsx)(J,{}),contentToolbar:Object(y.jsxs)(f.a,{value:a,onChange:function(e,t){c(t)},indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto",classes:{root:"w-full h-64"},children:[Object(y.jsx)(x.a,{className:"h-64",label:o("BASIC_INFO_TAB")}),Object(y.jsx)(x.a,{className:"h-64",label:o("DETAIL_TAB")}),Object(y.jsx)(x.a,{className:"h-64",label:o("PDF_TAB")})]}),content:Object(y.jsxs)("div",{className:"p-16 sm:p-24 max-w-2xl w-full",children:[Object(y.jsx)("div",{className:0!==a?"hidden":"",children:Object(y.jsx)(A,{})}),Object(y.jsx)("div",{className:1!==a?"hidden":"",children:Object(y.jsx)(V,{})}),Object(y.jsx)("div",{className:2!==a?"hidden":"",children:Object(y.jsx)(ne,{order:{reference:"asfasf",date:"2023-02-23 14:14:14",customer:{firstName:"fas",lastName:"asf",invoiceAddress:{address:"asfasf"},phone:"fsaf",email:"asfas"},products:[],subtotal:12,tax:233,discount:123,total:2424}})})]})})}))}))}}]);